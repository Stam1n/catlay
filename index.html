<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CATLAY 2025</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body::-webkit-scrollbar, .modal-content::-webkit-scrollbar { display: none; }
        body, .modal-content { -ms-overflow-style: none; scrollbar-width: none; }

        :root { --red: #ff0033; --bg: #000000; --font-head: 'Orbitron', sans-serif; --font-body: 'Montserrat', sans-serif; }
        body { margin: 0; background: var(--bg); color: #fff; font-family: var(--font-body); overflow-x: hidden; min-height: 100vh; padding-bottom: 50px; padding-top: 60px; }

        body::after { content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%; box-shadow: inset 0 0 100px rgba(255, 0, 51, 0.15); pointer-events: none; z-index: 8000; }

        /* MAINTENANCE SCREEN */
        #maintenanceScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 20000; display: none;
            flex-direction: column; align-items: center; justify-content: center;
            text-align: center;
        }
        #maintenanceScreen h1 { font-size: 3em; color: var(--red); margin-bottom: 20px; animation: pulse 2s infinite; }
        #maintenanceScreen p { font-size: 1.2em; color: #888; max-width: 80%; }

        /* TIMER PILL */
        .timer-pill {
            position: fixed; top: 10px; left: 50%; transform: translateX(-50%);
            background: rgba(10, 0, 0, 0.8); border: 1px solid #444;
            color: #ccc; text-align: center;
            padding: 8px 15px; font-family: var(--font-head); font-weight: 700;
            z-index: 10005; border-radius: 30px;
            backdrop-filter: blur(5px); cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            width: auto; min-width: 120px; max-height: 40px; overflow: hidden;
        }
        .timer-pill:hover, .timer-pill.expanded {
            background: rgba(20, 0, 5, 0.95); border-color: var(--red);
            box-shadow: 0 5px 25px rgba(255,0,51,0.4);
            padding: 15px 30px; max-height: 150px; color: #fff;
        }
        .pill-label { display: none; font-size: 0.6em; color: var(--red); margin-bottom: 5px; white-space: nowrap; letter-spacing: 1px; }
        .pill-date { display: none; font-size: 0.6em; color: #888; margin-top: 5px; font-family: var(--font-body); text-transform: uppercase; white-space: nowrap;}
        .pill-time { font-size: 1.1em; letter-spacing: 2px; line-height: 1; }
        .timer-pill:hover .pill-label, .timer-pill:hover .pill-date, .timer-pill.expanded .pill-label, .timer-pill.expanded .pill-date { display: block; }
        .timer-pill:hover .pill-time, .timer-pill.expanded .pill-time { font-size: 1.4em; color: var(--red); text-shadow: 0 0 10px var(--red); margin: 5px 0; }

        .ambient-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; background: radial-gradient(circle at 50% 50%, #150005 0%, #000 90%); }
        .particles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
        .particle { position: absolute; background: var(--red); border-radius: 50%; animation: rise 5s infinite; opacity: 0; }
        @keyframes rise { 0% {transform:translateY(100vh) scale(0); opacity:0;} 50% {opacity:1;} 100% {transform:translateY(-10vh) scale(1.5); opacity:0;} }

        header { text-align: center; padding: 30px 20px 20px; position: relative; }
        h1 { font-family: var(--font-head); font-size: 3.5em; color: var(--red); margin: 0; text-transform: uppercase; letter-spacing: 5px; text-shadow: 0 0 30px var(--red); line-height: 1; }
        .intro { max-width: 600px; margin: 10px auto; color: #888; font-weight: 700; text-transform: uppercase; font-size: 0.9em; }

        .header-btns-container { position: absolute; top: 60px; width: 100%; left: 0; padding: 0 20px; display: none; justify-content: space-between; z-index: 10001; pointer-events: auto; }
        .header-btn { background: rgba(0,0,0,0.8); border: 1px solid var(--red); color: var(--red); padding: 8px 20px; border-radius: 30px; cursor: pointer; font-family: var(--font-body); font-weight: 900; text-transform: uppercase; transition: 0.3s; font-size: 0.75em; }
        .header-btn:hover { background: var(--red); color: #000; box-shadow: 0 0 20px var(--red); }
        @media (min-width: 768px) { .header-btns-container { display: flex; } }

        .fab { position: fixed; bottom: 20px; width: 55px; height: 55px; background: rgba(0,0,0,0.9); border: 2px solid var(--red); color: var(--red); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; cursor: pointer; z-index: 10001; font-weight: 900; box-shadow: 0 0 15px rgba(0,0,0,0.8); transition: 0.3s; opacity: 0; transform: translateY(50px); pointer-events: none; }
        @media (max-width: 767px) { .fab { opacity: 1; transform: translateY(0); pointer-events: auto; } }
        .fab.visible { opacity: 1; transform: translateY(0); pointer-events: auto; }
        .fab:hover { background: var(--red); color: #000; box-shadow: 0 0 30px var(--red); transform: scale(1.1); }
        .fab-rules { left: 20px; } .fab-profile { right: 20px; }

        .section-title { text-align: center; font-family: var(--font-head); color: var(--red); font-size: 2em; text-transform: uppercase; margin: 40px 0 30px; text-shadow: 0 0 15px rgba(255,0,51,0.4); letter-spacing: 2px; }

        /* --- REALISTIC TICKET (SCRATCH) --- */
        .ticket-section {
            display: none; /* JS toggles this */
            max-width: 600px; margin: 30px auto; padding: 0 10px;
        }
        
        .real-ticket {
            background: #0f0f0f;
            border: 2px solid #333;
            border-radius: 12px;
            position: relative;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
            overflow: hidden;
            display: flex; flex-direction: column;
        }
        
        /* Notches (Holes) */
        .real-ticket::before, .real-ticket::after {
            content: ''; position: absolute; top: 50%; transform: translateY(-50%);
            width: 30px; height: 30px; background: #000; /* Match body bg */
            border-radius: 50%; z-index: 10;
            box-shadow: inset 0 0 10px #000;
        }
        .real-ticket::before { left: -15px; border-right: 2px solid #333; }
        .real-ticket::after { right: -15px; border-left: 2px solid #333; }

        .ticket-header-area {
            background: linear-gradient(90deg, #200, #500, #200);
            padding: 15px; text-align: center;
            border-bottom: 2px dashed #444;
        }
        .ticket-name {
            font-family: var(--font-head); color: #fff; font-size: 1.5em; letter-spacing: 2px;
            text-shadow: 0 0 10px var(--red);
        }
        
        .ticket-body {
            padding: 20px 40px; 
            background: repeating-linear-gradient(45deg, #111 0, #111 10px, #151515 10px, #151515 20px);
            display: flex; flex-direction: column; align-items: center;
        }

        .scratch-strip {
            display: flex; gap: 0; /* Connected */
            background: #222; border: 2px solid #555;
            border-radius: 8px; overflow: hidden;
            box-shadow: inset 0 0 20px #000;
            margin-bottom: 10px;
        }

        .segment-wrap {
            position: relative; width: 80px; height: 100px;
            border-right: 1px dashed #555;
        }
        .segment-wrap:last-child { border-right: none; }

        .code-reveal {
            width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            font-family: monospace; font-size: 1.8em; color: #fff;
            background: #111; user-select: none;
        }
        
        /* RED RARITY BACKGROUND */
        .code-reveal.rarity-red {
            background: linear-gradient(135deg, #500, #900);
            color: #fff; text-shadow: 0 0 10px #fff;
            animation: redPulse 2s infinite;
        }
        @keyframes redPulse { 0% { box-shadow: inset 0 0 10px #f00; } 50% { box-shadow: inset 0 0 30px #f00; } 100% { box-shadow: inset 0 0 10px #f00; } }

        canvas.scratch-canvas {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            cursor: url('https://img.icons8.com/ios-filled/24/ffffff/coins.png'), auto;
            touch-action: none;
        }
        
        .seat-reward {
            width: 100%; text-align: center; margin-top: 10px;
            color: var(--red); font-weight: bold; cursor: pointer;
            animation: pulse 2s infinite; display: none; font-size: 0.9em;
            text-transform: uppercase; letter-spacing: 1px;
        }
        .seat-reward:hover { text-decoration: underline; text-shadow: 0 0 10px var(--red); }

        /* WINGS */
        .wing { 
            position: absolute; top: 50%; 
            font-size: 3.5em; color: var(--red); 
            opacity: 0; transition: opacity 0.4s ease-in-out, transform 0.4s ease; 
            z-index: 0; filter: drop-shadow(0 0 10px rgba(255,0,51,0.5)); 
            pointer-events: none; 
        }
        .wing-left { transform: translateY(-50%) scaleX(-1); } 
        .wing-right { transform: translateY(-50%); }

        .main-slide .wing-left { left: -80px; }
        .main-slide .wing-right { right: -80px; }
        .main-slide:hover .wing-left { transform: translateY(-50%) scaleX(-1) scale(1.1); }
        .main-slide:hover .wing-right { transform: translateY(-50%) scale(1.1); }
        
        .slay-item .wing-left { left: -10px; }
        .slay-item .wing-right { right: -10px; }
        .slay-item:hover .wing-left { transform: translateY(-50%) scaleX(-1) scale(1.1); }
        .slay-item:hover .wing-right { transform: translateY(-50%) scale(1.1); }

        .main-slide.active.voted .wing, .slay-item.active.voted .wing { opacity: 1; }

        /* MAIN SLIDER */
        .main-section { position: relative; height: 550px; display: flex; align-items: center; justify-content: center; perspective: 1000px; margin-bottom: 50px; overflow: hidden; }
        .main-container { position: relative; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; }
        .main-slide { position: absolute; width: 300px; height: 420px; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: all 0.6s cubic-bezier(0.25, 0.8, 0.25, 1); background: transparent; border: none; cursor: pointer; overflow: visible; }
        
        .main-slide::before {
            content:''; position: absolute; top:50%; left:50%; transform:translate(-50%,-50%);
            width: 110%; height: 110%; 
            background: radial-gradient(circle, rgba(255,0,51,0.6) 0%, transparent 70%); 
            z-index: -1; pointer-events: none; filter: blur(40px); opacity: 0.8; 
            transition: opacity 0.5s, filter 0.5s;
        }
        .main-slide.active::before { opacity: 1; filter: blur(50px); }
        .main-slide:hover::before { opacity: 1; filter: blur(60px); background: radial-gradient(circle, rgba(255,0,51,0.8) 0%, transparent 80%); }

        .main-slide.active { transform: translateX(0) scale(1.1); z-index: 10; opacity: 1; }
        .main-slide.prev { transform: translateX(-350px) scale(0.85) rotateY(15deg); z-index: 5; opacity: 0.4; filter: blur(2px) grayscale(1); pointer-events: none; }
        .main-slide.next { transform: translateX(350px) scale(0.85) rotateY(-15deg); z-index: 5; opacity: 0.4; filter: blur(2px) grayscale(1); pointer-events: none; }
        .main-slide.hidden { transform: scale(0.5); opacity: 0; pointer-events: none; z-index: 0; }
        
        .main-slide img { width: 100%; height: 100%; object-fit: contain; transition: 0.5s; position: absolute; top: 0; left: 0; z-index: 1; filter: drop-shadow(0 0 10px rgba(0,0,0,0.5)); transform: scale(1.25); }
        .main-slide.active:hover img { transform: scale(1.35); filter: brightness(1.2) drop-shadow(0 0 20px rgba(255,0,51,0.3)); }
        
        .ph-wrap { width: 100%; height: 100%; position: absolute; top:0; left:0; z-index: 1; display: flex; align-items: center; justify-content: center; background: transparent; }
        .text-ph { font-family: var(--font-head); font-size: 6em; color: #333; text-transform: uppercase; }
        .main-slide h3 { font-family: var(--font-head); color: #fff; margin: 0; position: absolute; bottom: 0; width: 150%; text-transform: uppercase; font-size: 1.3em; text-align: center; text-shadow: 0 0 10px #000; transition: 0.3s; pointer-events: none; }
        .main-slide.active:hover h3 { color: var(--red); text-shadow: 0 0 20px var(--red); transform: scale(0.8); }

        .arrow { position: absolute; top: 50%; transform: translateY(-50%); font-size: 3em; color: var(--red); cursor: pointer; z-index: 20; background: rgba(0,0,0,0.5); border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; transition: 0.3s; }
        .arrow:hover { background: var(--red); color: #fff; box-shadow: 0 0 20px var(--red); }
        @media (max-width: 768px) { .main-slide { width: 240px; height: 360px; } .main-slide.prev { transform: translateX(-150px) scale(0.8) rotateY(10deg); opacity: 0.3; } .main-slide.next { transform: translateX(150px) scale(0.8) rotateY(-10deg); opacity: 0.3; } }

        /* SLAY */
        .slay-section { margin-top: 30px; position: relative; padding-bottom: 80px; }
        .slay-wrapper { position: relative; height: 450px; display: flex; justify-content: center; align-items: center; overflow: visible; perspective: 1200px; }
        .slay-track { position: relative; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; transform-style: preserve-3d; }
        
        .slay-item { 
            position: absolute; top: 50%; left: 50%; width: 260px; height: 360px; 
            transform: translate(-50%, -50%); 
            transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.5s, z-index 0s;
            display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; 
        }
        
        .slay-img { width: 100%; height: 100%; object-fit: contain; filter: drop-shadow(0 10px 15px rgba(0,0,0,0.5)); transition: transform 0.3s ease-out, filter 0.3s; z-index: 2; }
        
        .slay-item:hover { z-index: 101 !important; }
        .slay-item:hover .slay-img { transform: scale(1.1) translateY(-10px); filter: drop-shadow(0 20px 30px rgba(255,0,51,0.4)); }
        
        /* Force wing scale on hover via parent */
        .slay-item:hover .wing-left { transform: translateY(-50%) scaleX(-1) scale(1.1); }
        .slay-item:hover .wing-right { transform: translateY(-50%) scale(1.1); }
        
        .slay-title { 
            position: absolute; bottom: 10px; width: 140%; text-align: center; 
            font-family: var(--font-head); font-size: 1.4em; color: #fff; 
            text-transform: uppercase; font-weight: 900; letter-spacing: 2px;
            text-shadow: 0 2px 10px #000;
            transition: all 0.3s ease; pointer-events: none; opacity: 0.7; transform: scale(0.9); z-index: 3;
        }
        .slay-item.active .slay-title { opacity: 1; transform: scale(1); text-shadow: 0 0 15px var(--red), 0 0 30px var(--red); }
        .slay-item:hover .slay-title { color: var(--red); transform: scale(1.1) translateY(-5px); text-shadow: 0 0 20px var(--red), 0 0 10px rgba(255,255,255,0.3); }
        
        .slay-item .wing { font-size: 3em; z-index: 1; } 

        .slay-item::before {
            content:''; position: absolute; top:50%; left:50%; transform:translate(-50%,-50%);
            width: 130%; height: 130%; background: radial-gradient(circle, rgba(255,0,51,0.3) 0%, transparent 70%);
            z-index: -1; pointer-events: none; filter: blur(20px); opacity: 0; transition: opacity 0.5s ease 0.3s;
        }
        .slay-item.active::before { opacity: 1; }

        .slay-nav { position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); display: flex; gap: 30px; align-items: center; z-index: 200; }
        .slay-btn { background: none; border: none; color: var(--red); font-size: 2em; cursor: pointer; transition: 0.2s; }
        .slay-btn:active { transform: scale(0.9); }
        .slay-cnt { font-family: var(--font-head); font-size: 1.2em; color: var(--red); }

        /* SUGGESTIONS BLURRED */
        .suggest-section { max-width: 90%; width: 600px; margin: 50px auto; padding: 25px; background: transparent; border: none; position: relative; overflow: hidden; }
        .suggest-section.chained .suggest-form, .suggest-section.chained .slots-container, .suggest-section.chained .suggest-desc, .suggest-section.chained .sug-counter-box { opacity: 0.4; pointer-events: none; filter: blur(8px); }
        .suggest-section.chained .lock-icon-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex !important; flex-direction: column; align-items: center; justify-content: center; z-index: 20; }
        .lock-icon-overlay i { font-size: 5em; color: var(--red); text-shadow: 0 0 20px #000; margin-bottom: 15px; }
        .lock-text { color: var(--red); font-family: var(--font-head); font-size: 1.5em; text-shadow: 0 0 10px #000; text-transform: uppercase; font-weight: 900; }
        
        .suggest-header { text-align: center; color: var(--red); font-family: var(--font-head); margin-bottom: 5px; font-size: 1.5em; }
        .suggest-desc { text-align: center; color: #888; font-size: 0.9em; margin-bottom: 20px; line-height: 1.5; }
        .sug-counter-box { text-align: center; margin-bottom: 15px; font-family: var(--font-head); color: #fff; }
        .slots-container { display: flex; justify-content: center; gap: 8px; margin-bottom: 20px; }
        .slot { width: 12px; height: 12px; border: 2px solid #333; border-radius: 50%; transition: 0.3s; }
        .slot.filled { background: var(--red); border-color: var(--red); box-shadow: 0 0 8px var(--red); }
        .suggest-form input, .suggest-form textarea { width: 100%; background: #111; border: 1px solid #333; color: #fff; padding: 12px; margin-bottom: 12px; font-family: var(--font-body); border-radius: 8px; }
        .suggest-btn { width: 100%; padding: 15px; background: #222; color: #fff; border: none; font-weight: 900; cursor: pointer; text-transform: uppercase; transition: 0.3s; border-radius: 8px; border: 1px solid #333; }
        .suggest-btn:hover { background: var(--red); border-color: var(--red); }
        .sug-history { margin-top: 20px; border-top: 1px solid #222; padding-top: 15px; }
        .sug-item { background: #111; padding: 10px; margin-bottom: 6px; border-radius: 5px; border-left: 3px solid var(--red); font-size: 0.85em; color: #ccc; display: flex; justify-content: space-between; align-items: center; }
        .edit-sug-btn { background: none; border: none; color: #555; cursor: pointer; font-size: 1.1em; }
        .edit-sug-btn:hover { color: var(--red); }

        .cand-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; margin-top: 20px; }
        .cand-card { background: #151515; border: 1px solid #333; padding: 20px 10px; text-align: center; cursor: pointer; border-radius: 12px; display: flex; flex-direction: column; align-items: center; height: 100%; min-height: 180px; transition: 0.3s; }
        .cand-card:hover { border-color: var(--red); transform: translateY(-5px); box-shadow: 0 0 20px rgba(255,0,51,0.2); }
        .cand-avatar { width: 100%; height: 100px; margin-bottom: 15px; border-radius: 10px; border: 2px solid #333; background: #222; display: flex; align-items: center; justify-content: center; font-size: 2.5em; color: #666; object-fit: cover; transition: 0.3s; position: relative; }
        .cand-avatar img { border-radius: 10px; }
        .video-badge { position: absolute; top: -8px; right: -8px; background: var(--red); color: #fff; width: 28px; height: 28px; border-radius: 50%; font-size: 14px; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 10px #000; z-index: 10; border: 2px solid #fff; }
        .cand-card.big-mode .cand-avatar { height: 120px; font-size: 4em; }
        .cand-name { font-weight: bold; font-size: 1.1em; line-height: 1.3; }
        .cand-card.selected { border-color: var(--red); background: #2a0005; box-shadow: 0 0 15px rgba(255,0,51,0.3); transform: translateY(-5px); }
        .cand-card.selected .cand-avatar { border-color: var(--red); color: var(--red); }
        .cand-avatar i { font-size: 2em; background: linear-gradient(to bottom, var(--red), #440000); -webkit-background-clip: text; -webkit-text-fill-color: transparent; filter: drop-shadow(0 0 5px var(--red)); }

        .custom-vote-area { margin-top: 30px; border-top: 1px solid #333; padding-top: 20px; }
        .custom-input { width: 100%; background: #111; border: 1px solid #444; color: #fff; padding: 12px; border-radius: 8px; font-family: var(--font-body); margin-bottom: 10px; }
        .custom-btn { width: 100%; background: #333; color: #ccc; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .custom-btn:hover { background: #444; color: #fff; }
        
        .change-panel { background: #2a0000; border: 1px solid var(--red); border-radius: 8px; padding: 15px; margin-top: 20px; text-align: center; position: relative; }
        .change-btn { background: var(--red); color: #fff; border: none; padding: 10px 20px; border-radius: 5px; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.3s; }
        .change-btn:disabled { background: #555; cursor: not-allowed; opacity: 0.7; }
        .change-timer { font-size: 0.8em; color: #fa0; margin-top: 5px; display: block; font-family: monospace; }

        .preview-btn { width: 100%; padding: 15px; background: var(--red); color: #fff; border: none; font-weight: 900; text-transform: uppercase; font-size: 1.2em; cursor: pointer; border-radius: 6px; margin-top: 20px; box-shadow: 0 0 20px rgba(255,0,51,0.3); animation: btnPulse 2s infinite; }
        .preview-btn:hover { background: #fff; color: var(--red); animation: none; }
        @keyframes btnPulse { 0% { box-shadow: 0 0 0 0 rgba(255, 0, 51, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(255, 0, 51, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 0, 51, 0); } }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10000; align-items: center; justify-content: center; padding: 10px; }
        .modal.active { display: flex; animation: openPulse 0.3s forwards; }
        @keyframes openPulse { 0% { opacity: 0; transform: scale(0.95); } 100% { opacity: 1; transform: scale(1); } }
        .modal-content { width: 100%; max-width: 600px; max-height: 85vh; overflow-y: auto; padding: 30px 20px; border: 2px solid #333; background: #0a0a0a; border-radius: 12px; position: relative; }
        
        .close { position: absolute; top: 10px; right: 15px; font-size: 40px; cursor: pointer; color: #555; line-height: 1; z-index: 100; transition: 0.3s; }
        .close:hover { color: var(--red); transform: rotate(90deg) scale(1.1); }

        #previewMediaContainer { width: 100%; text-align: center; margin-bottom: 20px; min-height: 200px; display: flex; align-items: center; justify-content: center; background: #111; border-radius: 10px; border: 1px solid #333; overflow: hidden; }
        #previewMediaContainer img, #previewMediaContainer video { width: 100%; max-height: 50vh; object-fit: contain; }

        .token-box { width: 100%; border: 2px dashed #333; background: #000; color: var(--red); font-family: var(--font-head); font-size: 2em; text-align: center; padding: 15px; margin: 10px 0; border-radius: 8px; letter-spacing: 3px; }
        .check-btn { background: var(--red); color: #fff; padding: 12px 20px; border: none; font-weight: bold; border-radius: 8px; cursor: pointer; width: 100%; font-size: 1.1em; margin-top: 10px; transition: 0.3s; }
        .check-btn:disabled { background: #555; cursor: not-allowed; }
        
        .reset-btn { background: #220000; color: #ff5555; border: 1px solid #500; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 0.9em; margin-top: 15px; font-weight: bold; width: 100%; text-transform: uppercase; transition: 0.3s; }
        .reset-btn:hover { background: #400; color: #fff; border-color: var(--red); }

        /* TOAST - TOP LAYER */
        .toast { 
            position: fixed; top: 80px; left: 50%; transform: translateX(-50%) translateY(-200%); 
            background: #111; border: 1px solid var(--red); 
            padding: 15px 30px; border-radius: 30px; 
            color: #fff; z-index: 99999; /* MAX Z-INDEX */
            opacity: 0; transition: all 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55); 
            font-weight: 900; box-shadow: 0 10px 30px rgba(0,0,0,0.8);
            font-family: var(--font-body); letter-spacing: 1px;
        }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }

        /* GLOBAL CLOSED STATE STYLES */
        body.vote-closed .main-slide, body.vote-closed .slay-item { filter: grayscale(1); opacity: 0.7; pointer-events: none; }
        body.vote-closed .arrow, body.vote-closed .slay-btn { display: none; }
        body.vote-closed .main-slide::after, body.vote-closed .slay-item::after {
            content: '\f023'; font-family: "Font Awesome 5 Free"; font-weight: 900;
            position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%);
            font-size: 4em; color: #fff; text-shadow: 0 0 20px #000; z-index: 200;
        }
        #closedMessage { display: none; color: var(--red); text-align: center; margin-top: 20px; font-weight: bold; }
        body.vote-closed #closedMessage { display: block; }

        /* SEAT MODAL */
        #seatModal { text-align: center; }
        #seatModal p { font-size: 1.2em; line-height: 1.5; color: #ccc; }
        #seatModal a { color: var(--red); text-decoration: none; font-weight: bold; }

        footer { text-align: center; padding: 40px 20px; color: #444; font-family: var(--font-head); font-size: 1.5em; border-top: 1px solid #222; margin-top: 50px; text-transform: uppercase; letter-spacing: 2px; }
    </style>
</head>
<body>
    <div id="maintenanceScreen">
        <h1>üõ† –¢–ï–•. –†–ê–ë–û–¢–´</h1>
        <p>–°–∞–π—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–∫—Ä—ã—Ç –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ.<br>–ó–∞–π–¥–∏—Ç–µ –ø–æ–∑–∂–µ.</p>
    </div>

    <div class="timer-pill" id="globalTimer" onclick="this.classList.toggle('expanded')">
        <div class="pill-label">–ó–ê–ö–†–´–¢–ò–ï –í–°–ï–• –ì–û–õ–û–°–û–í–ê–ù–ò–ô –ß–ï–†–ï–ó</div>
        <div class="pill-time" id="pillTime">--:--:--</div>
        <div class="pill-date">24 –î–ï–ö–ê–ë–†–Ø 20:00 –ú–°–ö</div>
    </div>

    <div class="ambient-bg"></div>
    <div class="particles" id="particles"></div>
    <div id="toast" class="toast">Info</div>

    <div class="header-btns-container">
        <button class="header-btn" onclick="openModal('rulesModal')"><i class="fas fa-gavel"></i> –ü–†–ê–í–ò–õ–ê</button>
        <button class="header-btn" onclick="openProfile()"><i class="fas fa-user"></i> –ü–†–û–§–ò–õ–¨</button>
    </div>

    <div class="fab fab-rules" onclick="openModal('rulesModal')"><i class="fas fa-gavel"></i></div>
    <div class="fab fab-profile" onclick="openProfile()"><i class="fas fa-user"></i></div>

    <header id="mainHeader">
        <h1>CATLAY</h1>
        <div style="font-family: var(--font-head); color: #666; letter-spacing: 3px; margin-top: 10px;">2025 AWARDS</div>
        <p class="intro">–¢–≤–æ–π –≥–æ–ª–æ—Å —Ä–µ—à–∞–µ—Ç —Å—É–¥—å–±—É —Å–µ—Ä–≤–µ—Ä–∞</p>
    </header>

    <div id="closedMessage">
        <h2>–ì–û–õ–û–°–û–í–ê–ù–ò–ï –ó–ê–ö–†–´–¢–û</h2>
        <p style="color:#ccc;">–ü—Ä–µ–º–∏—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è 27 –¥–µ–∫–∞–±—Ä—è.</p>
    </div>

    <div class="ticket-section" id="ticketSection">
        <div class="golden-ticket">
            <div class="ticket-header-area">
                <div class="ticket-name">GOLDEN TICKET</div>
            </div>
            <div class="ticket-body">
                <div class="scratch-strip" id="ticketSegments">
                    </div>
                <div class="seat-reward" id="seatReward" onclick="openModal('seatModal')">
                    üéü –í–´–ë–û–† –õ–Æ–ë–û–ì–û –ú–ï–°–¢–ê –°–ò–î–ï–ù–ò–Ø
                </div>
            </div>
        </div>
    </div>

    <h2 class="section-title">–û–°–ù–û–í–ù–´–ï –ù–û–ú–ò–ù–ê–¶–ò–ò</h2>

    <section class="main-section">
        <div class="arrow" style="left: 5%;" onclick="moveMain(-1)"><i class="fas fa-chevron-left"></i></div>
        <div class="arrow" style="right: 5%;" onclick="moveMain(1)"><i class="fas fa-chevron-right"></i></div>
        <div id="mainContainer" class="main-container"></div>
    </section>

    <div class="section-separator"></div>

    <section class="slay-section" id="addNomSection">
        <h2 class="section-title">–î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ù–û–ú–ò–ù–ê–¶–ò–ò</h2>
        <div class="slay-wrapper"><div class="slay-track" id="slayTrack"></div></div>
        <div class="slay-nav">
            <button class="slay-btn" onclick="moveSlay(-1)"><i class="fas fa-caret-left"></i></button>
            <div class="slay-cnt" id="slayCount">1/9</div>
            <button class="slay-btn" onclick="moveSlay(1)"><i class="fas fa-caret-right"></i></button>
        </div>
    </section>

    <section class="suggest-section chained" id="sugSection">
        <div class="lock-icon-overlay">
            <i class="fas fa-lock"></i>
            <div class="lock-text">–ü–†–ï–î–õ–û–ñ–ï–ù–ò–Ø –ó–ê–ö–†–´–¢–´</div>
        </div>
        
        <h3 class="suggest-header">–ü–†–ï–î–õ–û–ñ–ò–¢–¨ –ù–û–ú–ò–ù–ê–¶–ò–Æ</h3>
        <p class="suggest-desc">
            –ö–∞–∂–¥—ã–π —á–µ–ª–æ–≤–µ–∫ –º–æ–∂–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –¥–æ 5 –Ω–æ–º–∏–Ω–∞—Ü–∏–π. <br>
            –ß–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è 3 —Å–∞–º—ã—Ö –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏–∑ –≤—Å–µ—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –ø–æ–ø–∞–¥—É—Ç –≤ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–æ–º–∏–Ω–∞—Ü–∏–∏ –∏ –∑–∞ –Ω–∏—Ö –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞—Ç—å.
        </p>
        <div class="sug-counter-box">–í–∞—à–∏ –∏–¥–µ–∏: <span id="sugCounterText">0/5</span> | –†–µ–¥. –æ—Å—Ç–∞–ª–æ—Å—å: <span id="sugEditCounter">5</span>/5</div>
        <div class="slots-container" id="slotsCont"></div>
        <div class="suggest-form" id="sugForm">
            <input type="text" id="sugName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
            <textarea id="sugDesc" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ" rows="3"></textarea>
            <button class="suggest-btn" id="sugSubmitBtn" onclick="sendSuggestion()">–û–¢–ü–†–ê–í–ò–¢–¨</button>
            <button class="suggest-btn" id="sugCancelBtn" onclick="cancelEdit()" style="display:none; background:#444; margin-top:10px;">–û–¢–ú–ï–ù–ê</button>
        </div>
        <div id="sugLimitMsg" style="display:none; text-align:center; color:var(--red); font-weight:bold; margin-bottom:20px;">–õ–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω!</div>
        <div class="sug-history" id="sugHistory" style="display:none;"><h4>–ò—Å—Ç–æ—Ä–∏—è:</h4><div id="sugList"></div></div>
    </section>

    <div id="voteModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('voteModal')">&times;</span>
            <h2 id="voteTitle" style="font-family: var(--font-head); color: #fff; margin-top: 0; text-align:center;"></h2>
            <div id="lockedMessage" style="display:none; text-align:center; padding:10px;">
                <h3 style="color:#888;">–í–´ –£–ñ–ï –ü–†–û–ì–û–õ–û–°–û–í–ê–õ–ò</h3>
                <div class="change-panel">
                    <p style="color:#ccc;">–í—ã–±–æ—Ä: <b id="votedName" style="color:var(--red);"></b></p>
                    <p style="font-size:0.9em; color:#888;">–ò–∑–º–µ–Ω–µ–Ω–∏–π: <span id="changesLeft">3</span>/3</p>
                    <button id="changeBtn" class="change-btn" onclick="unlockVote()">–ò–ó–ú–ï–ù–ò–¢–¨ –ì–û–õ–û–°</button>
                    <span id="changeTimer" class="change-timer"></span>
                </div>
            </div>
            <div class="cand-grid" id="candGrid"></div>
            <div class="custom-vote-area">
                <p style="color:#888; font-size:0.9em; margin-bottom:10px;">–ù–µ—Ç –≤ —Å–ø–∏—Å–∫–µ? –ü—Ä–µ–¥–ª–æ–∂–∏—Ç–µ —Å–≤–æ–µ–≥–æ:</p>
                <input type="text" id="customCandName" class="custom-input" placeholder="–ù–∏–∫–Ω–µ–π–º –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ...">
                <button class="custom-btn" onclick="submitCustomVote()">–ì–û–õ–û–°–û–í–ê–¢–¨ –ó–ê –°–í–û–ï–ì–û</button>
            </div>
        </div>
    </div>

    <div id="previewModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('previewModal')">&times;</span>
            <h2 id="previewTitle" style="font-family: var(--font-head); color: #fff; margin-top: 0; text-align:center;"></h2>
            <div id="previewMediaContainer"><div style="color:#666">–ó–∞–≥—Ä—É–∑–∫–∞...</div></div>
            <button class="preview-btn" onclick="confirmVote()">–ì–û–õ–û–°–û–í–ê–¢–¨</button>
        </div>
    </div>

    <div id="profileModal" class="modal">
        <div class="modal-content" style="text-align: center;">
            <span class="close" onclick="closeModal('profileModal')">&times;</span>
            <h2 style="font-family: var(--font-head); color: var(--red); margin-top: 0;">–ü–†–û–§–ò–õ–¨</h2>
            <div id="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <div id="profileContent" style="display:none;">
                <div id="statusText" style="font-weight:900; color: #555; margin-bottom: 20px; font-size: 1.1em; font-family: var(--font-head);">–ù–ï –ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–ù</div>
                <div id="authSection">
                    <p style="font-size:0.9em; color:#ccc;">–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–¥ –±–æ—Ç—É <a href="https://t.me/CatLay_bot" target="_blank" style="color:var(--red);">@CatLay_bot</a></p>
                    <input type="text" value="---" readonly class="token-box" id="tokenDisplay">
                    <div id="timer" style="color:#666; font-family:monospace; margin:10px 0;">--:--</div>
                    <button id="checkBtn" class="check-btn" onclick="check(true)">–û–ë–ù–û–í–ò–¢–¨</button>
                    <div><button class="reset-btn" onclick="hardReset()">–°–ë–†–û–°–ò–¢–¨ –ö–û–î (–ï–°–õ–ò –ò–°–¢–ï–ö)</button></div>
                </div>
                <div style="display: flex; justify-content: space-around; margin-top: 30px; border-top: 1px solid #333; padding-top: 20px;">
                    <div><h3 id="statVoted" style="color:var(--red);">0</h3><p>–ì–æ–ª–æ—Å–æ–≤</p></div>
                    <div><h3 id="statLeft">15</h3><p>–û—Å—Ç–∞–ª–æ—Å—å</p></div>
                    <div id="statSugBox"><h3 id="statSug" style="color:#888;">0</h3><p>–ò–¥–µ–π</p></div>
                </div>
                <div id="adminPanel" style="display:none; margin-top:20px; border-top:1px solid #333; padding-top:10px;">
                    <button class="header-btn" id="testBtn" onclick="toggleTestMode()">TEST MODE: OFF</button>
                </div>
            </div>
        </div>
    </div>

    <div id="seatModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('seatModal')">&times;</span>
            <h2 style="font-family: var(--font-head); color: var(--red);">–í–´–ë–û–† –ú–ï–°–¢–ê</h2>
            <p>
                –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í–∞–º –≤—ã–ø–∞–ª–∞ —Ä–µ–¥–∫–∞—è —á–∞—Å—Ç—å –±–∏–ª–µ—Ç–∞.<br><br>
                –ù–∞–ø–∏—à–∏—Ç–µ –≤ Telegram <a href="https://t.me/stam1n">@stam1n</a>.<br>
                –ú—ã –æ—Ç–ø—Ä–∞–≤–∏–º –≤–∞–º –∫–∞—Ä—Ç—É –∑–∞–ª–∞, –∏ –≤—ã —Å–º–æ–∂–µ—Ç–µ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ª—é–±–æ–µ –º–µ—Å—Ç–æ –µ—â—ë –¥–æ –Ω–∞—á–∞–ª–∞ –ü—Ä–µ–º–∏–∏.
            </p>
        </div>
    </div>

    <div id="rulesModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('rulesModal')">&times;</span>
            <h2 style="font-family: var(--font-head); text-align:center;">–ü–†–ê–í–ò–õ–ê</h2>
            <div style="color:#ccc; line-height:1.6; font-size:0.9em;">
                <p>1. –ì–æ–ª–æ—Å—É–π—Ç–µ –∑–∞ —Ç–µ—Ö –Ω–æ–º–∏–Ω–∞–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã—Ö —Å—á–∏—Ç–∞–µ—Ç–µ –Ω–∞–∏–±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–º–∏.</p>
                <p>2. –ó–∞–ø—Ä–µ—â–µ–Ω–æ –≥–æ–ª–æ—Å–æ–≤–∞—Ç—å —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤.</p>
                <p>3. –ó–∞–ø—Ä–µ—â–µ–Ω–æ –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –Ω–æ–º–∏–Ω–∞–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∏–∫–∞–∫ –Ω–µ –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ —Ç–µ–º–µ.</p>
                <p>4. –ó–∞–ø—Ä–µ—â–µ–Ω–æ –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω–æ –±—Ä–µ–¥–æ–≤—ã–µ –Ω–æ–º–∏–Ω–∞—Ü–∏–∏.</p>
                <p>5. –ó–∞–ø—Ä–µ—â–µ–Ω–æ –∞–±—É–∑–∏—Ç—å –±–∞–≥–∏ —Å–∞–π—Ç–∞ (—Å–æ–æ–±—â–∞–π—Ç–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞–º CLAY).</p>
                <p>6. –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –¢–û–õ–¨–ö–û –æ –º–æ–º–µ–Ω—Ç–∞—Ö —Å –ö–µ—Ç—Ñ–∏–ª–¥–∞, –Ω–∞—á–∏–Ω–∞—è —Å 2025 –≥–æ–¥–∞.</p>
                <p>7. –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ–ø–∞–¥–∞—é—Ç –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø—É–ª –Ω–æ–º–∏–Ω–∞–Ω—Ç–æ–≤.</p>
                <p>8. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –ø—Ä–µ–º–∏–∏.</p>
            </div>
        </div>
    </div>

    <footer>2025 CatField - CLAY</footer>

    <script>
        const API_URL = "https://sstamin.pythonanywhere.com"; 

        const mainNoms = [
            {title: "–ö–æ—Ä–æ–ª—å CLAY", isPerson: true, cands: ["Foltt1k", "Machinae", "fifa20120022", "SStamin", "Yanantess", "Homiki0"]},
            {title: "–ö–æ—Ä–æ–ª–µ–≤–∞ CLAY", isPerson: true, cands: ["BaBdjoN", "k4agune", "l0lpiks", "Marusan19", "Poroxhaha"]},
            {title: "–õ—É—á—à–∞—è –ø–æ—Å—Ç—Ä–æ–π–∫–∞", isPerson: false, cands: ["–ë–∞–∑–∞ —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–π –∫—Ñ4", "–û—Å—Ç—Ä–æ–≤ –°–° –º–∏–Ω–∏ –∫—Ñ4", "–û—Å—Ç—Ä–æ–≤ BaBdjoN –∫—Ñ5", "–°–ø–∞–≤–Ω –∫—Ñ4", "–°–ø–∞–≤–Ω –∫—Ñ5", "–ë–∞–∑–∞ Machinae –ö–§4"]},
            {title: "–§–µ–π–ª –≥–æ–¥–∞", isPerson: false, cands: ["–ö—Ä–∞–∂–∞ —è–π—Ü–∞ —É —Å—Å –∫—Ñ4", "–ü—Ä–∏–≤–∞—Ç—ã 42—Ö42", "–ú–µ–∂—Å–µ–∑–æ–Ω—å–µ", "–£—Ö–æ–¥ —Å—Ç–∞–º–∏–Ω–∞", "–ö–ª–µ–π 2024", "Sdas_garula x-ray"]},
            {title: "–ß–µ–ª–æ–≤–µ–∫ –º–µ–º", isPerson: true, cands: ["Homiki0", "Timoxa118", "SStamin", "Chumachecha", "vital3000", "Foltt1k", "kkkkkeeeefff", "NarkoBobr1k"]},
            {title: "–ó–∞–≤–æ–∑ –≥–æ–¥–∞", isPerson: false, cands: ["–í–æ–π–Ω–∞ –ø—Ä–∞–Ω–∫–æ–≤ –∫—Ñ5", "–ü—Ä–∞–≤–∏–ª–∞ —Å—Å –∫—Ñ4-–∫—Ñ5", "42—Ö42 –±–ª–æ–∫–∞", "–í–∑—Ä—ã–≤ –∑–∞–ø—Ä–µ—Ç–Ω–æ–π –∑–æ–Ω—ã"]},
            {title: "–ö–ª–∞–Ω/–ö–æ–º–∞–Ω–¥–∞", isPerson: false, cands: ["SSquadra", "–í–û–°–•–û–î", "zz / –ö–üZZ", "–¢–¶–ö", "AUGUST"]}
        ];
        
        const subNomsList = [
            {title: "–õ—É—á—à–∏–π —Å—Ç—Ä–æ–∏—Ç–µ–ª—å", isPerson: true, cands: ["BaBdjoN", "MetOssinka", "Foltt1k", "k4agune", "kkkkkeeeefff", "l0lpiks", "flakePok", "Machinae"], imgId: 0}, 
            {title: "–õ—É—á—à–∏–π –ü–í–ü", isPerson: true, cands: ["Foltt1k", "fifa20120022", "mirik2025", "Homiki0", "SStamin", "NarkoBobr1k", "OduVaNchIIk", "KToYuO_O", "Sdas_garula"], imgId: 1},
            {title: "–°–∫–∏–Ω –≥–æ–¥–∞", isPerson: true, cands: ["k4agune", "BaBdjoN", "Foltt1k", "MetOssinka", "Homiki0"], imgId: 2},
            {title: "–ü–∞—Ä–∞/–®–∏–ø –≥–æ–¥–∞", isPerson: false, cands: ["Homik + BaBdjoN", "Poroxhaha + KQOS_Kara", "mirik2025 + fifa20120022", "Marusan19 + SumyRaider", "k4agune + BaBdjoN", "Marusan19 + Foltt1k", "k4agune + Foltt1k"], imgId: 3},
            {title: "–ü–∏–∑–¥–∞–±–æ–ª –≥–æ–¥–∞", isPerson: true, cands: ["Yanantess", "Sdas_garula", "SStamin", "Homiki0", "Timoxa118"], imgId: 4},
            {title: "–ê—Ñ–∫ –≥–æ–¥–∞", isPerson: true, cands: ["Yanantess", "MetOssinka", "Chumachecha", "Illyuha", "Safov"], imgId: 5},
            {title: "–§–∞—Ä–º–∏–ª–∞ –≥–æ–¥–∞", isPerson: true, cands: ["Sdas_garula", "Homiki0", "BaBdjoN", "SStamin", "fifa2012022", "wwawkkk", "vital3000", "k4agune"], imgId: 6},
            {title: "–°—Ç—Ä–∏–º–µ—Ä –≥–æ–¥–∞", isPerson: true, cands: ["Foltt1k", "BaBdjoN", "Manshikage (–ü–µ–ª—å–º–µ–Ω—å)", "EnterUp (–¢–æ—Ä—Ñ)", "pehaold"], imgId: 7}
        ];
        const totalNoms = mainNoms.length + subNomsList.length;
        
        let myVotes = {}, myChanges = {}, mySugs = []; 
        let editModeId = null; 
        let sugEditsCount = 0;
        let serverTimeOffset = 0;
        let DEADLINE_CHANGE_VOTE = 0;
        let DEADLINE_GLOBAL = 0;
        let TICKET_UNLOCKS = [];
        let ticketData = {};

        // === SCRATCH CARD CLASS ===
        class ScratchCard {
            constructor(canvas, index) {
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d');
                this.index = index;
                this.isDrawing = false;
                this.scratchedPercent = 0;
                this.width = canvas.offsetWidth;
                this.height = canvas.offsetHeight;
                
                // High DPI fix
                this.canvas.width = this.width * 2;
                this.canvas.height = this.height * 2;
                this.ctx.scale(2, 2);
                
                this.initCover();
                this.bindEvents();
            }

            initCover() {
                this.ctx.fillStyle = '#444'; // Cover color
                this.ctx.fillRect(0, 0, this.width, this.height);
                
                // Add texture/text
                this.ctx.font = 'bold 12px monospace';
                this.ctx.fillStyle = '#888';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                this.ctx.fillText("–°–¢–ï–†–ï–¢–¨", this.width/2, this.height/2 - 10);
                this.ctx.fillText(`–ß–ê–°–¢–¨ ${this.index+1}`, this.width/2, this.height/2 + 10);
            }

            bindEvents() {
                const start = (e) => {
                    this.isDrawing = true;
                    this.scratch(e);
                };
                const move = (e) => {
                    if(this.isDrawing) this.scratch(e);
                };
                const end = () => {
                    if(this.isDrawing) {
                        this.isDrawing = false;
                        this.checkPercent();
                    }
                };

                this.canvas.addEventListener('mousedown', start);
                this.canvas.addEventListener('mousemove', move);
                this.canvas.addEventListener('mouseup', end);
                this.canvas.addEventListener('mouseleave', end);
                
                this.canvas.addEventListener('touchstart', (e) => { e.preventDefault(); start(e); });
                this.canvas.addEventListener('touchmove', (e) => { e.preventDefault(); move(e); });
                this.canvas.addEventListener('touchend', (e) => { e.preventDefault(); end(); });
            }

            scratch(e) {
                const rect = this.canvas.getBoundingClientRect();
                const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
                const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;

                this.ctx.globalCompositeOperation = 'destination-out';
                this.ctx.beginPath();
                this.ctx.arc(x, y, 15, 0, Math.PI * 2); // Brush size
                this.ctx.fill();
            }

            checkPercent() {
                // Optimization: Check only every few strokes or using a grid
                // Here we simplify: if user scratches enough, trigger API
                // For performance, we can just trigger API on first significant scratch or use getImageData
                
                // Simplified: Fetch API immediately on first scratch interaction end to allow server logic
                // The visual scratch is just for effect. 
                
                // Let's rely on visual feedback + API call.
                // We'll call API. If API says "too early", we reset canvas. If "ok", we remove canvas.
                scratchTicket(this.index, this);
            }
            
            clear() {
                this.canvas.style.opacity = '0';
                setTimeout(() => this.canvas.remove(), 500);
            }
            
            reset() {
                this.ctx.globalCompositeOperation = 'source-over';
                this.initCover();
            }
        }

        let mainIdx = 0;
        function initMain() {
            const cont = document.getElementById('mainContainer'); cont.innerHTML = '';
            mainNoms.forEach((n, i) => {
                let d = document.createElement('div'); d.className = 'main-slide hidden'; d.id = `ms-${i}`;
                let ph = `<div class="ph-wrap text-ph">${n.title.charAt(0)}</div>`;
                let wings = `<div class="wing wing-left"><i class="fas fa-feather-alt"></i></div><div class="wing wing-right"><i class="fas fa-feather-alt"></i></div>`;
                d.innerHTML = `${wings}${ph}<img src="${API_URL}/static/main_${i}.png" onload="this.style.opacity=1" onerror="this.style.opacity=0"><h3>${n.title}</h3>`;
                d.onclick = () => { if(document.body.classList.contains('vote-closed')) return; if(i===mainIdx) openVoteList(0, i); else { mainIdx=i; updateMain(); }};
                cont.appendChild(d);
            });
            updateMain();
        }
        function updateMain() {
            for(let i=0; i<mainNoms.length; i++) {
                let el = document.getElementById(`ms-${i}`);
                el.className = 'main-slide hidden';
                if(myVotes[mainNoms[i].title]) el.classList.add('voted'); else el.classList.remove('voted');
                if(i===mainIdx) el.className='main-slide active ' + (myVotes[mainNoms[i].title] ? 'voted' : '');
                else if(i===(mainIdx-1+mainNoms.length)%mainNoms.length) el.className='main-slide prev';
                else if(i===(mainIdx+1)%mainNoms.length) el.className='main-slide next';
            }
        }
        function moveMain(d) { if(document.body.classList.contains('vote-closed')) return; mainIdx=(mainIdx+d+mainNoms.length)%mainNoms.length; updateMain(); }

        let slayIdx = 0;
        function initSlay() {
            const tr = document.getElementById('slayTrack'); tr.innerHTML = '';
            subNomsList.forEach((n, i) => {
                let d = document.createElement('div'); d.className = 'slay-item'; d.id = `sl-${i}`;
                d.innerHTML = `
                    <div class="wing wing-left"><i class="fas fa-feather-alt"></i></div><div class="wing wing-right"><i class="fas fa-feather-alt"></i></div>
                    <img src="${API_URL}/static/sub_${n.imgId}.png" class="slay-img" onerror="this.style.display='none'">
                    <div class="slay-title">${n.title}</div>`;
                d.onclick = () => { if(document.body.classList.contains('vote-closed')) return; openVoteList(1, i); };
                tr.appendChild(d);
            });
            updateSlay();
        }
        
        function updateSlay() {
            for(let i=0; i<subNomsList.length; i++) {
                let el = document.getElementById(`sl-${i}`);
                let diff = i - slayIdx;
                
                if(myVotes[subNomsList[i].title]) el.classList.add('voted'); else el.classList.remove('voted');

                if (diff === 0) {
                    el.style.transform = `translate(-50%, -50%) translateZ(200px)`; 
                    el.style.zIndex = 100;
                    el.style.opacity = 1;
                    el.classList.add('active');
                } 
                else {
                    el.classList.remove('active');
                    let safeDiff = Math.max(-2, Math.min(2, diff)); 
                    let xOffset = safeDiff * 260; 
                    let zOffset = 100 - Math.abs(safeDiff) * 100; 
                    let rotateY = -safeDiff * 25; 
                    let opacity = Math.abs(diff) > 2 ? 0 : 0.6; 

                    el.style.transform = `translate(-50%, -50%) translate3d(${xOffset}px, 0, ${zOffset}px) rotateY(${rotateY}deg)`;
                    el.style.zIndex = 50 - Math.abs(diff);
                    el.style.opacity = opacity;
                }
            }
            document.getElementById('slayCount').innerText = `${slayIdx+1} / ${subNomsList.length}`;
        }
        function moveSlay(d) { if(document.body.classList.contains('vote-closed')) return; slayIdx+=d; if(slayIdx<0) slayIdx=0; if(slayIdx>=subNomsList.length) slayIdx=subNomsList.length-1; updateSlay(); }

        initMain(); initSlay();

        function openModal(id){ 
            if(id === 'voteModal' || id === 'profileModal') document.getElementById('globalTimer').style.display = 'none';
            document.getElementById(id).classList.add('active'); 
        }
        function closeModal(id){ 
            document.getElementById(id).classList.remove('active');
            if(id === 'voteModal' || id === 'profileModal') document.getElementById('globalTimer').style.display = 'flex';
            if(id === 'previewModal') {
                const v = document.querySelector('#previewMediaContainer video');
                if(v) { v.pause(); v.currentTime=0; }
                document.getElementById('previewMediaContainer').innerHTML = ''; 
            }
        }
        
        document.getElementById('sugSection').classList.add('chained');
        function startEdit() { toast("–ó–∞–∫—Ä—ã—Ç–æ!"); }
        function cancelEdit() {}
        async function sendSuggestion() { toast("–ó–∞–∫—Ä—ã—Ç–æ!"); }
        
        let currGroup, currIdx;
        function openVoteList(group, idx) {
            let now = Date.now() / 1000 + serverTimeOffset;
            let isTest = document.getElementById('testBtn') && document.getElementById('testBtn').innerText.includes("ON");
            if(now > DEADLINE_GLOBAL && !isTest) { toast("–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ!"); return; }

            currGroup = group; currIdx = idx;
            let nom = group===0 ? mainNoms[idx] : subNomsList[idx];
            
            document.getElementById('voteTitle').innerText = nom.title;
            const g = document.getElementById('candGrid'); g.innerHTML='';
            
            let votedFor = myVotes[nom.title];
            let changesDone = myChanges[nom.title] || 0;
            
            checkChangeVoteValidity();

            let isLocked = votedFor !== undefined;
            if(isLocked) {
                document.getElementById('lockedMessage').style.display = 'block';
                document.getElementById('votedName').innerText = votedFor;
                document.getElementById('changesLeft').innerText = (3 - changesDone);
                g.classList.add('locked');
            } else {
                document.getElementById('lockedMessage').style.display = 'none';
                g.classList.remove('locked');
            }

            nom.cands.forEach(c => {
                let d = document.createElement('div'); d.className = 'cand-card';
                if(votedFor === c) d.classList.add('selected');

                let safeNom = nom.title.replace(/[\s\/]/g, '_');
                let safeCand = c.replace(/[\s\/]/g, '_');
                let imgPng = `${API_URL}/static/cand_${safeNom}_${safeCand}.png`;
                let imgJpg = `${API_URL}/static/cand_${safeNom}_${safeCand}.jpg`;
                
                let vidUrl = `${API_URL}/static/cand_${safeNom}_${safeCand}.mp4`;
                let vidBadge = `<div id="vid-${safeCand}" class="video-badge" style="display:none"><i class="fas fa-video"></i></div>`;
                let vtest = document.createElement('video'); vtest.src = vidUrl;
                vtest.onloadedmetadata = () => { document.getElementById(`vid-${safeCand}`).style.display = 'flex'; };

                let phIcon = nom.isPerson ? '<i class="fas fa-user"></i>' : c.charAt(0);
                
                d.innerHTML = `
                    <div class="cand-avatar">
                        ${vidBadge}
                        <img src="${imgPng}" style="width:100%;height:100%;object-fit:cover;border-radius:10px;display:none;" 
                             onload="this.style.display='block'; this.nextElementSibling.style.display='none'"
                             onerror="this.onerror=null; this.src='${imgJpg}'">
                        <span>${phIcon}</span>
                    </div>
                    <div class="cand-name">${c}</div>`;
                
                d.onclick=()=>{ if(!g.classList.contains('locked')) openPreview(c); };
                g.appendChild(d);
            });
            
            if(votedFor && !nom.cands.includes(votedFor)) {
               document.getElementById('customCandName').value = votedFor;
            } else {
               document.getElementById('customCandName').value = ''; 
            }
            openModal('voteModal');
        }

        function checkChangeVoteValidity() {
            let now = Date.now() / 1000 + serverTimeOffset;
            let btn = document.getElementById('changeBtn');
            let timerSpan = document.getElementById('changeTimer');
            let isTest = document.getElementById('testBtn') && document.getElementById('testBtn').innerText.includes("ON");

            if(now > DEADLINE_CHANGE_VOTE && !isTest) {
                btn.disabled = true;
                btn.innerText = "–í–†–ï–ú–Ø –í–´–®–õ–û";
                timerSpan.innerText = "–ò–∑–º–µ–Ω–∏—Ç—å –≥–æ–ª–æ—Å –±–æ–ª—å—à–µ –Ω–µ–ª—å–∑—è";
            } else {
                let diff = Math.floor(DEADLINE_CHANGE_VOTE - now);
                let h = Math.floor(diff/3600);
                let m = Math.floor((diff%3600)/60);
                btn.disabled = false;
                btn.innerText = "–ò–ó–ú–ï–ù–ò–¢–¨ –ì–û–õ–û–°";
                timerSpan.innerText = `–û—Å—Ç–∞–ª–æ—Å—å: ${h}—á ${m}–º`;
            }
        }

        function unlockVote() {
            let now = Date.now() / 1000 + serverTimeOffset;
            let isTest = document.getElementById('testBtn') && document.getElementById('testBtn').innerText.includes("ON");
            if(now > DEADLINE_CHANGE_VOTE && !isTest) { toast("–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ!"); return; }
            document.getElementById('candGrid').classList.remove('locked');
            document.getElementById('lockedMessage').style.display = 'none';
        }

        function openPreview(candName) {
            currentCand = candName;
            closeModal('voteModal');
            openModal('previewModal');
            document.getElementById('previewTitle').innerText = candName;
            const container = document.getElementById('previewMediaContainer');
            container.innerHTML = '<div style="color:#666">–ü–æ–∏—Å–∫ –º–µ–¥–∏–∞...</div>';
            
            let nom = currGroup===0 ? mainNoms[currIdx] : subNomsList[currIdx];
            let safeNom = nom.title.replace(/[\s\/]/g, '_');
            let safeCand = candName.replace(/[\s\/]/g, '_');
            let vidUrl = `${API_URL}/static/cand_${safeNom}_${safeCand}.mp4`;
            let imgPng = `${API_URL}/static/cand_${safeNom}_${safeCand}.png`;
            let imgJpg = `${API_URL}/static/cand_${safeNom}_${safeCand}.jpg`;
            
            let video = document.createElement('video');
            video.src = vidUrl; video.controls = true; video.autoplay = true; video.muted = false; video.loop = true;
            
            video.onloadedmetadata = () => { container.innerHTML = '<div style="color:#0f0">–í–∏–¥–µ–æ –Ω–∞–π–¥–µ–Ω–æ, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...</div>'; };
            video.oncanplay = () => { container.innerHTML = ''; container.appendChild(video); };
            
            video.onerror = () => {
                let img = new Image(); img.src = imgPng;
                img.onload = () => { container.innerHTML = ''; container.appendChild(img); };
                img.onerror = () => {
                    let img2 = new Image(); img2.src = imgJpg;
                    img2.onload = () => { container.innerHTML = ''; container.appendChild(img2); };
                    img2.onerror = () => { container.innerHTML = '<div style="font-size:8em;color:var(--red);padding:40px;"><i class="fas fa-user"></i></div>'; }
                }
            };
        }

        async function confirmVote() { closeModal('previewModal'); sendVote(currentCand); }
        async function submitCustomVote() {
            const val = document.getElementById('customCandName').value;
            if(!val) { toast("–í–≤–µ–¥–∏—Ç–µ –∏–º—è!"); return; }
            sendVote(val);
        }

        async function sendVote(cand) {
            let nomTitle = currGroup===0 ? mainNoms[currIdx].title : subNomsList[currIdx].title;
            myVotes[nomTitle] = cand; 
            updateSlay(); updateMain();

            try {
                let res = await fetch(API_URL + '/api/vote', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({token:myToken, nomination:nomTitle, candidate:cand})});
                let d = await res.json();
                if(d.success) { toast("–ü–†–ò–ù–Ø–¢–û!"); check(false); }
                else { 
                    toast(d.message);
                    if(d.message !== "–ü–†–ò–ù–Ø–¢–û!") { delete myVotes[nomTitle]; updateSlay(); updateMain(); }
                }
            } catch(e) { toast("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏"); }
        }

        // --- TICKET SYSTEM ---
        function initTicketSystem() {
            const container = document.getElementById('ticketSegments');
            container.innerHTML = '';
            
            let hasRed = false;
            
            for(let i=0; i<4; i++) {
                let wrap = document.createElement('div');
                wrap.className = 'segment-wrap';
                
                // Reveal Layer (Code)
                let reveal = document.createElement('div');
                reveal.className = 'code-reveal';
                reveal.id = `reveal-${i}`;
                
                // Canvas Layer
                let canvas = document.createElement('canvas');
                canvas.className = 'scratch-canvas';
                canvas.id = `canvas-${i}`;
                
                if (ticketData[i]) {
                    reveal.innerText = ticketData[i].code;
                    if(ticketData[i].rarity === 'red') {
                        reveal.classList.add('rarity-red');
                        hasRed = true;
                    }
                    // No canvas if opened
                } else {
                    reveal.innerText = "??"; // Placeholder until scratched
                    wrap.appendChild(canvas);
                    // Init Scratch Logic
                    setTimeout(() => new ScratchCard(canvas, i), 100);
                }
                
                wrap.appendChild(reveal);
                container.appendChild(wrap);
            }
            
            document.getElementById('seatReward').style.display = hasRed ? 'block' : 'none';
        }

        async function scratchTicket(idx, scratchObj) {
            if(Object.keys(myVotes).length === 0) { toast("–°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≥–æ–ª–æ—Å—É–π—Ç–µ!"); scratchObj.reset(); return; }
            
            let now = Date.now() / 1000 + serverTimeOffset;
            let isTest = document.getElementById('testBtn') && document.getElementById('testBtn').innerText.includes("ON");

            if (!isTest && now < TICKET_UNLOCKS[idx]) {
                let date = new Date(TICKET_UNLOCKS[idx] * 1000);
                toast(`–î–æ—Å—Ç—É–ø–Ω–æ —Å ${date.getDate()} –¥–µ–∫ 12:00`);
                scratchObj.reset();
                return;
            }

            try {
                let res = await fetch(API_URL + '/api/scratch_ticket', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({token:myToken, segment:idx})});
                let d = await res.json();
                if(d.success) {
                    ticketData[idx] = d.data;
                    // Update reveal text
                    let reveal = document.getElementById(`reveal-${idx}`);
                    reveal.innerText = d.data.code;
                    if(d.data.rarity === 'red') {
                        reveal.classList.add('rarity-red');
                        document.getElementById('seatReward').style.display = 'block';
                    }
                    scratchObj.clear(); // Fade out canvas
                } else {
                    toast(d.message || "–û—à–∏–±–∫–∞");
                    scratchObj.reset();
                }
            } catch(e) { toast("–û—à–∏–±–∫–∞"); scratchObj.reset(); }
        }

        async function toggleTestMode() {
            try {
                let res = await fetch(API_URL + '/api/toggle_test', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({token:myToken})});
                let d = await res.json();
                if(d.success) check(false);
            } catch(e) { toast("–û—à–∏–±–∫–∞"); }
        }

        let myToken = localStorage.getItem('tk');
        let tokenTimer;
        let lastCheckTime = 0;

        async function openProfile() {
            openModal('profileModal');
            if(!myToken) await refreshToken(); else check(false);
        }

        async function refreshToken() {
            try {
                let res = await fetch(API_URL + '/api/get_token');
                let d = await res.json();
                if(d.maintenance) { document.getElementById('maintenanceScreen').style.display = 'flex'; return; }
                myToken = d.token; localStorage.setItem('tk', myToken);
                check(false);
            } catch(e) { toast("–ù–µ—Ç —Å–≤—è–∑–∏"); }
        }
        
        function hardReset() {
            localStorage.removeItem('tk');
            myToken = null;
            refreshToken();
        }

        async function check(manual) {
            const btn = document.getElementById('checkBtn');
            if(manual) {
                if(Date.now() - lastCheckTime < 5000) { toast("–ü–æ–¥–æ–∂–¥–∏—Ç–µ..."); return; }
                lastCheckTime = Date.now();
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>'; 
                btn.style.background = "#555";
                btn.disabled = true;
            }

            try {
                let res = await fetch(API_URL + '/api/check_status', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({token:myToken})});
                let d = await res.json();
                
                if(d.maintenance) { document.getElementById('maintenanceScreen').style.display = 'flex'; return; }
                else document.getElementById('maintenanceScreen').style.display = 'none';

                if (d.expired) { 
                    if(document.getElementById('profileModal').classList.contains('active')) { refreshToken(); return; }
                    document.getElementById('statusText').innerText = "–ö–û–î –ò–°–¢–ï–ö";
                    document.getElementById('statusText').style.color = "red";
                    document.getElementById('loading').style.display='none';
                    document.getElementById('profileContent').style.display='block';
                    if(manual) { 
                        btn.innerText = "–ò–°–¢–ï–ö"; btn.style.background = "red"; 
                        setTimeout(()=>{btn.innerText="–û–ë–ù–û–í–ò–¢–¨"; btn.style.background="var(--red)"; btn.disabled=false;}, 2000); 
                    }
                    return; 
                }

                document.getElementById('loading').style.display='none';
                document.getElementById('profileContent').style.display='block';
                const tokenInput = document.getElementById('tokenDisplay');
                tokenInput.value = myToken; tokenInput.readOnly = true;

                document.getElementById('statVoted').innerText = d.vote_count || 0;
                document.getElementById('statLeft').innerText = totalNoms - (d.vote_count || 0);
                
                myVotes = d.my_votes || {}; 
                myChanges = d.changes || {}; 
                sugEditsCount = d.sug_edits || 0;
                ticketData = d.ticket_data || {};
                
                serverTimeOffset = d.server_time - (Date.now()/1000);
                
                DEADLINE_SUGGEST = d.deadlines.sug;
                DEADLINE_CHANGE_VOTE = d.deadlines.change;
                DEADLINE_GLOBAL = d.deadlines.global;
                TICKET_UNLOCKS = d.deadlines.ticket;

                // SHOW TICKET IF TIME OR TEST
                let now = Date.now() / 1000 + serverTimeOffset;
                if(now > DEADLINE_GLOBAL || d.is_test) {
                    document.getElementById('ticketSection').style.display = 'block';
                    initTicketSystem();
                } else {
                    document.getElementById('ticketSection').style.display = 'none';
                }

                if(d.is_admin) {
                    document.getElementById('adminPanel').style.display = 'block';
                    const tBtn = document.getElementById('testBtn');
                    if(d.is_test) {
                        tBtn.innerText = "TEST MODE: ON (RESET)";
                        tBtn.style.background = "#0f0";
                        tBtn.style.color = "#000";
                    } else {
                        tBtn.innerText = "TEST MODE: OFF";
                        tBtn.style.background = "rgba(0,0,0,0.8)";
                        tBtn.style.color = "var(--red)";
                    }
                }

                updateMain(); updateSlay();

                const st = document.getElementById('statusText');
                if(d.status==='approved') {
                    st.innerText = d.is_admin ? "ADMIN ACCESS" : "–ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–ù"; 
                    st.style.color = "#0f0";
                    document.getElementById('timer').style.display='none';
                    if(manual) { btn.innerText = "–£–°–ü–ï–•"; btn.style.background = "#0f0"; setTimeout(()=>{btn.innerText="–û–ë–ù–û–í–ò–¢–¨"; btn.style.background="var(--red)"; btn.disabled=false;}, 2000); }
                } else {
                    st.innerText = d.status==='review'?"–ù–ê –ü–†–û–í–ï–†–ö–ï":"–ù–ï –ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–ù";
                    st.style.color = d.status==='review'?"#fa0":"#555";
                    startTimer(d.code_life);
                    if(manual) { btn.innerText = "–ñ–î–ï–ú..."; btn.style.background = "#fa0"; setTimeout(()=>{btn.innerText="–û–ë–ù–û–í–ò–¢–¨"; btn.style.background="var(--red)"; btn.disabled=false;}, 2000); }
                }
            } catch(e) { 
                console.error(e); toast("–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞"); 
                if(manual) { btn.innerText = "–û–®–ò–ë–ö–ê"; btn.disabled=false; }
            }
        }

        function startTimer(s) {
            clearInterval(tokenTimer); 
            let l = Math.floor(s);
            const display = document.getElementById('timer');
            display.style.display = 'block';
            tokenTimer = setInterval(() => {
                if(l <= 0) { 
                    clearInterval(tokenTimer); display.innerText = "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ..."; 
                    if(document.getElementById('profileModal').classList.contains('active')) refreshToken();
                    return; 
                }
                l--; 
                let m = Math.floor(l / 60);
                let sc = l % 60;
                display.innerText = `${m}:${sc<10?'0'+sc:sc}`;
            }, 1000);
        }
        
        function toast(msg) { 
            let t = document.getElementById('toast'); 
            t.innerText = msg; 
            t.classList.add('show'); 
            setTimeout(() => t.classList.remove('show'), 3000); 
        }
        
        setInterval(() => {
            let now = Date.now() / 1000 + serverTimeOffset;
            let isTest = document.getElementById('testBtn') && document.getElementById('testBtn').innerText.includes("ON");
            
            let diff = Math.floor(DEADLINE_GLOBAL - now);
            if(diff <= 0 || isTest) {
                document.getElementById('pillTime').innerText = "00:00:00";
                document.body.classList.add('vote-closed');
                if(document.getElementById('voteModal').classList.contains('active')) closeModal('voteModal');
            } else {
                let h = Math.floor(diff / 3600); 
                let m = Math.floor((diff % 3600) / 60);
                let s = diff % 60;
                document.getElementById('pillTime').innerText = `${h<10?'0'+h:h}:${m<10?'0'+m:m}:${s<10?'0'+s:s}`;
                document.body.classList.remove('vote-closed');
            }
            if(document.getElementById('voteModal').classList.contains('active')) checkChangeVoteValidity();
        }, 1000);
        
        const pc = document.getElementById('particles');
        for(let i=0;i<40;i++) {
            let p=document.createElement('div'); p.className='particle';
            p.style.left=Math.random()*100+'%'; p.style.width=p.style.height=(Math.random()*5+2)+'px';
            p.style.animationDuration=(Math.random()*5+5)+'s'; p.style.animationDelay=Math.random()*5+'s';
            pc.appendChild(p);
        }
        
        window.addEventListener('scroll', ()=>{
            const headerBtns = document.querySelector('.header-btns-container');
            const h = document.getElementById('mainHeader').getBoundingClientRect();
            const showFab = h.bottom < 0;
            document.querySelector('.fab-rules').classList.toggle('visible', showFab);
            document.querySelector('.fab-profile').classList.toggle('visible', showFab);
            if(headerBtns && window.innerWidth > 768) { headerBtns.style.opacity = showFab ? '0' : '1'; headerBtns.style.pointerEvents = showFab ? 'none' : 'auto'; }
        });
        
        if(myToken) check(false); else refreshToken();
    </script>
</body>
</html>
