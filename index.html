<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CATLAY 2025</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        * { box-sizing: border-box; }
        :root { --red: #ff0033; --bg: #000000; --font-head: 'Orbitron', sans-serif; --font-body: 'Montserrat', sans-serif; }
        body { margin: 0; background: var(--bg); color: #fff; font-family: var(--font-body); overflow-x: hidden; min-height: 100vh; padding-bottom: 50px; }

        body::after { content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%; box-shadow: inset 0 0 100px rgba(255, 0, 51, 0.15); pointer-events: none; z-index: 8000; }

        .ambient-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; background: radial-gradient(circle at 50% 50%, #150005 0%, #000 90%); }
        .particles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
        .particle { position: absolute; background: var(--red); border-radius: 50%; animation: rise 5s infinite; opacity: 0; }
        @keyframes rise { 0% {transform:translateY(100vh) scale(0); opacity:0;} 50% {opacity:1;} 100% {transform:translateY(-10vh) scale(1.5); opacity:0;} }

        header { text-align: center; padding: 40px 20px 40px; position: relative; }
        h1 { font-family: var(--font-head); font-size: 3.5em; color: var(--red); margin: 0; text-transform: uppercase; letter-spacing: 5px; text-shadow: 0 0 30px var(--red); line-height: 1; }
        .intro { max-width: 600px; margin: 15px auto; color: #888; font-weight: 700; text-transform: uppercase; font-size: 0.9em; }

        .header-btns-container { position: absolute; top: 30px; width: 100%; left: 0; padding: 0 40px; display: none; justify-content: space-between; z-index: 100; }
        .header-btn { 
            background: rgba(0,0,0,0.8); border: 1px solid var(--red); color: var(--red); 
            padding: 10px 25px; border-radius: 30px; cursor: pointer; 
            font-family: var(--font-body); font-weight: 900; text-transform: uppercase; 
            transition: 0.3s; font-size: 0.8em; pointer-events: auto;
        }
        .header-btn:hover { background: var(--red); color: #000; box-shadow: 0 0 20px var(--red); }
        @media (min-width: 768px) { .header-btns-container { display: flex; } }

        .fab {
            position: fixed; bottom: 20px; width: 55px; height: 55px;
            background: rgba(0,0,0,0.9); border: 2px solid var(--red); color: var(--red);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 20px; cursor: pointer; z-index: 9000; font-weight: 900;
            box-shadow: 0 0 15px rgba(0,0,0,0.8); transition: 0.3s;
            opacity: 0; transform: translateY(50px); pointer-events: none;
        }
        @media (max-width: 767px) { .fab { opacity: 1; transform: translateY(0); pointer-events: auto; } }
        .fab.visible { opacity: 1; transform: translateY(0); pointer-events: auto; }
        .fab:hover { background: var(--red); color: #000; box-shadow: 0 0 30px var(--red); transform: scale(1.1); }
        .fab-rules { left: 20px; } .fab-profile { right: 20px; }

        .section-title { text-align: center; font-family: var(--font-head); color: var(--red); font-size: 2em; text-transform: uppercase; margin: 40px 0 30px; text-shadow: 0 0 15px rgba(255,0,51,0.4); letter-spacing: 2px; }

        /* MAIN SLIDER */
        .main-section { position: relative; height: 550px; display: flex; align-items: center; justify-content: center; perspective: 1000px; margin-bottom: 50px; overflow: hidden; }
        .main-container { position: relative; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; }
        .main-slide {
            position: absolute; width: 300px; height: 420px; display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: all 0.6s cubic-bezier(0.25, 0.8, 0.25, 1); background: transparent; border: none; cursor: pointer; overflow: visible;
        }
        .main-slide.active:hover { transform: scale(1.25) !important; z-index: 20; }
        .main-slide img { 
            width: 100%; height: 100%; object-fit: contain; 
            transition: 0.5s; position: absolute; top: 0; left: 0; z-index: 1; 
            filter: drop-shadow(0 0 10px rgba(0,0,0,0.5)); transform: scale(1.25);
        }
        .main-slide.active:hover img { transform: scale(1.35); filter: brightness(1.2) drop-shadow(0 0 20px rgba(255,0,51,0.3)); }
        .ph-wrap { width: 100%; height: 100%; position: absolute; top:0; left:0; z-index: 1; display: flex; align-items: center; justify-content: center; background: transparent; }
        .text-ph { font-family: var(--font-head); font-size: 6em; color: #333; text-transform: uppercase; }
        .wing { position: absolute; top: 50%; transform: translateY(-50%); font-size: 4em; color: var(--red); opacity: 0; transition: 0.5s; z-index: 0; filter: drop-shadow(0 0 10px rgba(255,0,51,0.5)); pointer-events: none; }
        .wing-left { left: -80px; transform: translateY(-50%) rotateY(180deg); }
        .wing-right { right: -80px; }
        .main-slide.voted .wing { opacity: 1; }
        .main-slide h3 { 
            font-family: var(--font-head); color: #fff; margin: 0; position: absolute; bottom: 0; width: 150%; 
            text-transform: uppercase; font-size: 1.3em; text-align: center; 
            text-shadow: 0 0 10px #000; transition: 0.3s; pointer-events: none; 
        }
        .main-slide.active:hover h3 { color: var(--red); text-shadow: 0 0 20px var(--red); transform: scale(0.8); }
        .main-slide.active { transform: translateX(0) scale(1.1); z-index: 10; opacity: 1; }
        .main-slide.prev { transform: translateX(-350px) scale(0.85) rotateY(15deg); z-index: 5; opacity: 0.4; filter: blur(2px) grayscale(1); pointer-events: none; }
        .main-slide.next { transform: translateX(350px) scale(0.85) rotateY(-15deg); z-index: 5; opacity: 0.4; filter: blur(2px) grayscale(1); pointer-events: none; }
        .main-slide.hidden { transform: scale(0.5); opacity: 0; pointer-events: none; z-index: 0; }
        .arrow { position: absolute; top: 50%; transform: translateY(-50%); font-size: 3em; color: var(--red); cursor: pointer; z-index: 20; background: rgba(0,0,0,0.5); border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; transition: 0.3s; }
        .arrow:hover { background: var(--red); color: #fff; box-shadow: 0 0 20px var(--red); }
        @media (max-width: 768px) { .main-slide { width: 240px; height: 360px; } .main-slide.prev { transform: translateX(-150px) scale(0.8) rotateY(10deg); opacity: 0.3; } .main-slide.next { transform: translateX(150px) scale(0.8) rotateY(-10deg); opacity: 0.3; } }

        /* LOCKED SLAY */
        .slay-section { margin-top: 30px; position: relative; padding-bottom: 80px; }
        .locked-notice { color: #555; font-family: var(--font-head); text-transform: uppercase; border: 1px solid #333; display: inline-block; padding: 10px 20px; border-radius: 20px; font-weight: bold; font-size: 0.8em; margin-bottom: 30px; text-align: center; }
        .locked-container { text-align: center; }
        .slay-wrapper { position: relative; height: 450px; perspective: 1000px; display: flex; justify-content: center; align-items: center; }
        .slay-track { position: relative; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; transform-style: preserve-3d; }
        .slay-item { position: absolute; width: 220px; height: 320px; transition: transform 0.6s, opacity 0.6s; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; }
        .slay-img { width: 100%; height: 100%; object-fit: contain; filter: blur(5px) brightness(0.4) grayscale(0.8); transition: 0.3s; transform: scale(1.25); }
        .slay-item:hover .slay-img { filter: blur(3px) brightness(0.6); transform: scale(1.35); }
        .slay-item.active .slay-img { filter: blur(4px) brightness(0.5); transform: scale(1.25); }
        .locked-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 5; display: flex; align-items: center; justify-content: center; pointer-events: none; }
        .locked-icon { font-size: 5em; color: var(--red); margin-top: -30px; text-shadow: 0 0 20px rgba(0,0,0,0.9); opacity: 1; }
        .slay-title { position: absolute; bottom: -50px; width: 140%; text-align: center; font-family: var(--font-head); font-size: 1em; color: #fff; text-transform: uppercase; opacity: 0; transition: 0.3s; }
        .slay-item.active { z-index: 100; }
        .slay-item.active .slay-title { opacity: 1; color: var(--red); }
        .slay-nav { position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); display: flex; gap: 30px; align-items: center; z-index: 50; }
        .slay-btn { background: none; border: none; color: var(--red); font-size: 2em; cursor: pointer; }
        .slay-cnt { font-family: var(--font-head); font-size: 1.2em; color: var(--red); }

        /* SUGGESTIONS */
        .suggest-section { max-width: 90%; width: 600px; margin: 50px auto; padding: 25px; border: 1px solid #333; background: #080808; border-radius: 15px; box-shadow: 0 0 30px rgba(0,0,0,0.8); }
        .suggest-header { text-align: center; color: var(--red); font-family: var(--font-head); margin-bottom: 5px; font-size: 1.5em; }
        .suggest-desc { text-align: center; color: #888; font-size: 0.9em; margin-bottom: 20px; line-height: 1.5; }
        .sug-counter-box { text-align: center; margin-bottom: 15px; font-family: var(--font-head); color: #fff; }
        .slots-container { display: flex; justify-content: center; gap: 8px; margin-bottom: 20px; }
        .slot { width: 12px; height: 12px; border: 2px solid #333; border-radius: 50%; transition: 0.3s; }
        .slot.filled { background: var(--red); border-color: var(--red); box-shadow: 0 0 8px var(--red); }
        .suggest-form input, .suggest-form textarea { width: 100%; background: #111; border: 1px solid #333; color: #fff; padding: 12px; margin-bottom: 12px; font-family: var(--font-body); border-radius: 8px; }
        .suggest-btn { width: 100%; padding: 15px; background: #222; color: #fff; border: none; font-weight: 900; cursor: pointer; text-transform: uppercase; transition: 0.3s; border-radius: 8px; border: 1px solid #333; }
        .suggest-btn:hover { background: var(--red); border-color: var(--red); }
        .sug-history { margin-top: 20px; border-top: 1px solid #222; padding-top: 15px; }
        .sug-item { background: #111; padding: 8px 12px; margin-bottom: 6px; border-radius: 5px; border-left: 3px solid var(--red); font-size: 0.85em; color: #ccc; }

        /* GRID */
        .cand-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; margin-top: 20px; }
        .cand-card { 
            background: #151515; border: 1px solid #333; position: relative;
            padding: 20px 10px; text-align: center; cursor: pointer; 
            border-radius: 12px; display: flex; flex-direction: column; align-items: center;
            height: 100%; min-height: 180px; transition: 0.3s;
        }
        .cand-card:hover { border-color: var(--red); transform: translateY(-5px); box-shadow: 0 0 20px rgba(255,0,51,0.2); }
        
        /* БЛОКИРОВКА СЕТКИ ЕСЛИ ГОЛОСОВАЛ */
        .cand-grid.locked { pointer-events: none; opacity: 0.5; filter: grayscale(1); }

        .cand-avatar { 
            width: 100%; height: 100px; margin-bottom: 15px; 
            border-radius: 10px; border: 2px solid #333; background: #222;
            display: flex; align-items: center; justify-content: center;
            font-size: 2.5em; color: #666; object-fit: cover; transition: 0.3s; position: relative;
        }
        .cand-avatar img { border-radius: 10px; }
        
        /* ИКОНКА ВИДЕО В СПИСКЕ */
        .video-badge {
            position: absolute; top: -5px; right: -5px; 
            background: var(--red); color: #fff; width: 25px; height: 25px; 
            border-radius: 50%; font-size: 12px; display: flex; 
            align-items: center; justify-content: center; 
            box-shadow: 0 0 10px #000; z-index: 10;
        }

        .cand-card.big-mode .cand-avatar { height: 120px; font-size: 4em; }
        .cand-name { font-weight: bold; font-size: 1.1em; line-height: 1.3; }
        .cand-card.selected { border-color: var(--red); background: #2a0005; box-shadow: 0 0 15px rgba(255,0,51,0.3); transform: translateY(-5px); }
        .cand-card.selected .cand-avatar { border-color: var(--red); color: var(--red); }
        .cand-avatar i { font-size: 2em; background: linear-gradient(to bottom, var(--red), #440000); -webkit-background-clip: text; -webkit-text-fill-color: transparent; filter: drop-shadow(0 0 5px var(--red)); }

        .custom-vote-area { margin-top: 30px; border-top: 1px solid #333; padding-top: 20px; }
        .custom-input { width: 100%; background: #111; border: 1px solid #444; color: #fff; padding: 12px; border-radius: 8px; font-family: var(--font-body); margin-bottom: 10px; }
        .custom-btn { width: 100%; background: #333; color: #ccc; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .custom-btn:hover { background: #444; color: #fff; }
        
        /* CHANGE VOTE PANEL */
        .change-panel {
            background: #2a0000; border: 1px solid var(--red); border-radius: 8px;
            padding: 15px; margin-top: 20px; text-align: center;
        }
        .change-btn {
            background: var(--red); color: #fff; border: none; padding: 8px 15px;
            border-radius: 5px; font-weight: bold; cursor: pointer; margin-top: 10px;
        }

        /* PREVIEW BUTTON */
        .preview-btn { width: 100%; padding: 15px; background: var(--red); color: #fff; border: none; font-weight: 900; text-transform: uppercase; font-size: 1.2em; cursor: pointer; border-radius: 6px; margin-top: 20px; box-shadow: 0 0 20px rgba(255,0,51,0.3); animation: btnPulse 2s infinite; }
        .preview-btn:hover { background: #fff; color: var(--red); animation: none; }
        @keyframes btnPulse { 0% { box-shadow: 0 0 0 0 rgba(255, 0, 51, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(255, 0, 51, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 0, 51, 0); } }

        /* MODALS */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10000; align-items: center; justify-content: center; padding: 10px; }
        .modal.active { display: flex; animation: openPulse 0.3s forwards; }
        @keyframes openPulse { 0% { opacity: 0; transform: scale(0.95); } 100% { opacity: 1; transform: scale(1); } }
        .modal-content { width: 100%; max-width: 600px; max-height: 85vh; overflow-y: auto; padding: 30px 20px; border: 2px solid #333; background: #0a0a0a; border-radius: 12px; position: relative; }
        .close { position: absolute; top: 10px; right: 15px; font-size: 35px; cursor: pointer; color: #555; line-height: 1; }
        .close:hover { color: var(--red); }

        #previewMediaContainer { width: 100%; text-align: center; margin-bottom: 20px; min-height: 200px; display: flex; align-items: center; justify-content: center; background: #111; border-radius: 10px; border: 1px solid #333; overflow: hidden; }
        #previewMediaContainer img, #previewMediaContainer video { width: 100%; max-height: 50vh; object-fit: contain; }

        /* PROFILE */
        .token-box { width: 100%; border: 2px dashed #333; background: #000; color: var(--red); font-family: var(--font-head); font-size: 2em; text-align: center; padding: 15px; margin: 10px 0; border-radius: 8px; letter-spacing: 3px; }
        .check-btn { background: var(--red); color: #fff; padding: 12px 20px; border: none; font-weight: bold; border-radius: 8px; cursor: pointer; width: 100%; font-size: 1.1em; margin-top: 10px; transition: 0.3s; }
        .check-btn:disabled { background: #555; cursor: not-allowed; }
        .reset-btn { background: transparent; color: #555; border: 1px solid #333; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.8em; margin-top: 15px; }
        .toast { position: fixed; top: 80px; left: 50%; transform: translateX(-50%) translateY(-100px); background: #111; border: 1px solid var(--red); padding: 15px 25px; border-radius: 30px; color: #fff; z-index: 20000; opacity: 0; transition: 0.4s; font-weight: bold; box-shadow: 0 5px 20px #000; }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }

        footer { text-align: center; padding: 40px 20px; color: #444; font-family: var(--font-head); font-size: 1.5em; border-top: 1px solid #222; margin-top: 50px; text-transform: uppercase; letter-spacing: 2px; }
    </style>
</head>
<body>
    <div class="ambient-bg"></div>
    <div class="particles" id="particles"></div>
    <div id="toast" class="toast">Info</div>

    <div class="header-btns-container">
        <button class="header-btn" onclick="openModal('rulesModal')"><i class="fas fa-gavel"></i> ПРАВИЛА</button>
        <button class="header-btn" onclick="openProfile()"><i class="fas fa-user"></i> ПРОФИЛЬ</button>
    </div>

    <div class="fab fab-rules" onclick="openModal('rulesModal')"><i class="fas fa-gavel"></i></div>
    <div class="fab fab-profile" onclick="openProfile()"><i class="fas fa-user"></i></div>

    <header id="mainHeader">
        <h1>CATLAY</h1>
        <div style="font-family: var(--font-head); color: #666; letter-spacing: 3px; margin-top: 10px;">2025 AWARDS</div>
        <p class="intro">Твой голос решает судьбу сервера</p>
    </header>

    <h2 class="section-title">ОСНОВНЫЕ НОМИНАЦИИ</h2>

    <section class="main-section">
        <div class="arrow" style="left: 5%;" onclick="moveMain(-1)"><i class="fas fa-chevron-left"></i></div>
        <div class="arrow" style="right: 5%;" onclick="moveMain(1)"><i class="fas fa-chevron-right"></i></div>
        <div id="mainContainer" class="main-container"></div>
    </section>

    <div class="section-separator"></div>

    <section class="slay-section">
        <h2 class="section-title">ДОПОЛНИТЕЛЬНЫЕ НОМИНАЦИИ</h2>
        <div class="locked-container"><div class="locked-notice"><i class="fas fa-lock"></i> Голосование откроется позже</div></div>
        <div class="slay-wrapper"><div class="slay-track" id="slayTrack"></div></div>
        <div class="slay-nav">
            <button class="slay-btn" onclick="moveSlay(-1)"><i class="fas fa-caret-left"></i></button>
            <div class="slay-cnt" id="slayCount">1/9</div>
            <button class="slay-btn" onclick="moveSlay(1)"><i class="fas fa-caret-right"></i></button>
        </div>
    </section>

    <section class="suggest-section">
        <h3 class="suggest-header">ПРЕДЛОЖИТЬ НОМИНАЦИЮ</h3>
        <p class="suggest-desc">
            Каждый человек может предложить до 5 номинаций. <br>
            Через некоторое время 3 самых популярных вариантов из всех предложенных попадут в дополнительные номинации и за них можно будет проголосовать.
        </p>
        <div class="sug-counter-box">Ваши идеи: <span id="sugCounterText">0/5</span></div>
        <div class="slots-container" id="slotsCont"></div>
        <div class="suggest-form" id="sugForm">
            <input type="text" id="sugName" placeholder="Название">
            <textarea id="sugDesc" placeholder="Краткое описание" rows="3"></textarea>
            <button class="suggest-btn" onclick="sendSuggestion()">ОТПРАВИТЬ</button>
        </div>
        <div id="sugLimitMsg" style="display:none; text-align:center; color:var(--red); font-weight:bold; margin-bottom:20px;">Лимит исчерпан!</div>
        <div class="sug-history" id="sugHistory" style="display:none;"><h4>История:</h4><div id="sugList"></div></div>
    </section>

    <div id="voteModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('voteModal')">&times;</span>
            <h2 id="voteTitle" style="font-family: var(--font-head); color: #fff; margin-top: 0; text-align:center;"></h2>
            
            <div id="lockedMessage" style="display:none; text-align:center; padding:20px;">
                <h3 style="color:#888;">ВЫ УЖЕ ПРОГОЛОСОВАЛИ</h3>
                <div class="change-panel">
                    <p style="color:#ccc;">Ваш выбор: <b id="votedName" style="color:var(--red);"></b></p>
                    <p style="font-size:0.9em; color:#888;">Изменений осталось: <span id="changesLeft">3</span>/3</p>
                    <button id="changeBtn" class="change-btn" onclick="unlockVote()">ИЗМЕНИТЬ ГОЛОС</button>
                </div>
            </div>

            <div class="cand-grid" id="candGrid"></div>
            
            <div class="custom-vote-area">
                <p style="color:#888; font-size:0.9em; margin-bottom:10px;">Нет в списке? Предложите своего:</p>
                <input type="text" id="customCandName" class="custom-input" placeholder="Никнейм или название...">
                <button class="custom-btn" onclick="submitCustomVote()">ГОЛОСОВАТЬ ЗА СВОЕГО</button>
            </div>
        </div>
    </div>

    <div id="previewModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('previewModal')">&times;</span>
            <h2 id="previewTitle" style="font-family: var(--font-head); color: #fff; margin-top: 0; text-align:center;"></h2>
            
            <div id="previewMediaContainer">
                <div style="color:#666">Загрузка...</div>
            </div>

            <button class="preview-btn" onclick="confirmVote()">ГОЛОСОВАТЬ</button>
        </div>
    </div>

    <div id="profileModal" class="modal">
        <div class="modal-content" style="text-align: center;">
            <span class="close" onclick="closeModal('profileModal')">&times;</span>
            <h2 style="font-family: var(--font-head); color: var(--red); margin-top: 0;">ПРОФИЛЬ</h2>
            <div id="loading">Загрузка...</div>
            <div id="profileContent" style="display:none;">
                <div id="statusText" style="font-weight:900; color: #555; margin-bottom: 20px; font-size: 1.1em; font-family: var(--font-head);">НЕ ЗАРЕГИСТРИРОВАН</div>
                <div id="authSection">
                    <p style="font-size:0.9em; color:#ccc;">Отправьте код боту <a href="https://t.me/CatLay_bot" target="_blank" style="color:var(--red);">@CatLay_bot</a></p>
                    <input type="text" value="---" readonly class="token-box" id="tokenDisplay">
                    <div id="timer" style="color:#666; font-family:monospace; margin:10px 0;">--:--</div>
                    <button id="checkBtn" class="check-btn" onclick="check(true)">ОБНОВИТЬ</button>
                    <div><button class="reset-btn" onclick="hardReset()">СБРОСИТЬ КОД (ЕСЛИ ИСТЕК)</button></div>
                </div>
                <div style="display: flex; justify-content: space-around; margin-top: 30px; border-top: 1px solid #333; padding-top: 20px;">
                    <div><h3 id="statVoted" style="color:var(--red);">0</h3><p>Голосов</p></div>
                    <div><h3 id="statLeft">15</h3><p>Осталось</p></div>
                </div>
            </div>
        </div>
    </div>

    <div id="rulesModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('rulesModal')">&times;</span>
            <h2 style="font-family: var(--font-head); text-align:center;">ПРАВИЛА</h2>
            <div style="color:#ccc; line-height:1.6; font-size:0.9em;">
                <p>1. Голосуйте за тех номинантов, которых считаете наиболее подходящими.</p>
                <p>2. Запрещено голосовать с нескольких аккаунтов.</p>
                <p>3. Запрещено предлагать номинантов, которые никак не относятся к теме.</p>
                <p>4. Запрещено предлагать абсолютно бредовые номинации.</p>
                <p>5. Запрещено абузить баги сайта (сообщайте организаторам CLAY).</p>
                <p>6. Голосование ТОЛЬКО о моментах с Кетфилда, начиная с 2025 года.</p>
                <p>7. Популярные предложения попадают в официальный пул номинантов.</p>
                <p>8. Результаты будут опубликованы после проведения премии.</p>
            </div>
        </div>
    </div>

    <footer>2025 CatField - CLAY</footer>

    <script>
        const API_URL = "https://sstamin.pythonanywhere.com"; 

        const mainNoms = [
            {title: "Король CLAY", isPerson: true, cands: ["Foltt1k", "Machinae", "fifa20120022", "SStamin", "Yanantess", "Homiki0"]},
            {title: "Королева CLAY", isPerson: true, cands: ["BaBdjoN", "k4agune", "l0lpiks", "Marusan19", "Poroxhaha"]},
            {title: "Лучшая постройка", isPerson: false, cands: ["База хранителей кф4", "Остров СС мини кф4", "Остров BaBdjoN кф5", "Спавн кф4", "Спавн кф5"]},
            {title: "Фейл года", isPerson: false, cands: ["Кража яйца у сс кф4", "Приваты 42х42", "Межсезонье", "Уход стамина", "Клей 2024", "Sdas_garula x-ray"]},
            {title: "Человек мем", isPerson: true, cands: ["Homiki0", "Timoxa118", "SStamin", "Chumachecha", "vital3000", "Foltt1k", "kkkkkeeeefff", "NarkoBobr1k"]},
            {title: "Завоз года", isPerson: false, cands: ["Война пранков кф5", "Правила сс кф4-кф5", "42х42 блока", "Взрыв запретной зоны"]},
            {title: "Клан/Команда", isPerson: false, cands: ["SSquadra", "ВОСХОД", "zz / КПZZ", "ТЦК", "AUGUST"]}
        ];
        const subNoms = ["Лучший строитель", "Лучший ПВП", "Скин года", "Пара/Шип года", "Пиздабол года"];
        const totalNoms = mainNoms.length;
        
        let myVotes = {}; 
        let myChanges = {};
        let currentCand = null; 

        let mainIdx = 0;
        function initMain() {
            const cont = document.getElementById('mainContainer'); cont.innerHTML = '';
            mainNoms.forEach((n, i) => {
                let d = document.createElement('div'); d.className = 'main-slide hidden'; d.id = `ms-${i}`;
                let ph = `<div class="ph-wrap text-ph">${n.title.charAt(0)}</div>`;
                let wings = `<div class="wing wing-left"><i class="fas fa-feather-alt"></i></div><div class="wing wing-right"><i class="fas fa-feather-alt"></i></div>`;
                d.innerHTML = `${wings}${ph}<img src="${API_URL}/static/main_${i}.png" onload="this.style.opacity=1" onerror="this.style.opacity=0"><h3>${n.title}</h3>`;
                d.onclick = () => { if(i===mainIdx) openVoteList(i); else { mainIdx=i; updateMain(); }};
                cont.appendChild(d);
            });
            updateMain();
        }
        function updateMain() {
            for(let i=0; i<mainNoms.length; i++) {
                let el = document.getElementById(`ms-${i}`);
                el.className = 'main-slide hidden';
                if(myVotes[mainNoms[i].title]) el.classList.add('voted'); else el.classList.remove('voted');
                if(i===mainIdx) el.className='main-slide active ' + (myVotes[mainNoms[i].title] ? 'voted' : '');
                else if(i===(mainIdx-1+mainNoms.length)%mainNoms.length) el.className='main-slide prev';
                else if(i===(mainIdx+1)%mainNoms.length) el.className='main-slide next';
            }
        }
        function moveMain(d) { mainIdx=(mainIdx+d+mainNoms.length)%mainNoms.length; updateMain(); }

        let slayIdx = 0;
        function initSlay() {
            const tr = document.getElementById('slayTrack'); tr.innerHTML = '';
            subNoms.forEach((title, i) => {
                let d = document.createElement('div'); d.className = 'slay-item'; d.id = `sl-${i}`;
                d.innerHTML = `
                    <div class="locked-overlay"><i class="fas fa-lock locked-icon"></i></div>
                    <img src="${API_URL}/static/sub_${i}.png" class="slay-img" onerror="this.style.display='none'">
                    <div class="slay-title">${title}</div>`;
                tr.appendChild(d);
            });
            updateSlay();
        }
        function updateSlay() {
            for(let i=0; i<subNoms.length; i++) {
                let el = document.getElementById(`sl-${i}`);
                let diff = i - slayIdx;
                let tf='', z=10, op=1;
                if(diff===0) { tf='translateX(0) scale(1.1) translateZ(50px)'; z=100; el.classList.add('active'); }
                else { tf=`translateX(${diff*240}px) scale(${1-Math.abs(diff)*0.2}) rotateY(${-Math.sign(diff)*15}deg) translateZ(${-Math.abs(diff)*50}px)`; op=Math.abs(diff)>2?0:1-Math.abs(diff)*0.3; z=50-Math.abs(diff); el.classList.remove('active'); }
                el.style.transform=tf; el.style.zIndex=z; el.style.opacity=op;
            }
            document.getElementById('slayCount').innerText = `${slayIdx+1} / ${subNoms.length}`;
        }
        function moveSlay(d) { slayIdx+=d; if(slayIdx<0) slayIdx=0; if(slayIdx>=subNoms.length) slayIdx=subNoms.length-1; updateSlay(); }

        initMain(); initSlay();

        function openModal(id){ document.getElementById(id).classList.add('active'); }
        function closeModal(id){ 
            document.getElementById(id).classList.remove('active');
            if(id === 'previewModal') document.getElementById('previewMediaContainer').innerHTML = '';
        }
        
        let currIdx;
        function openVoteList(idx) {
            currIdx = idx; 
            document.getElementById('voteTitle').innerText = mainNoms[idx].title;
            const g = document.getElementById('candGrid'); g.innerHTML='';
            
            let votedFor = myVotes[mainNoms[idx].title];
            let changesDone = myChanges[mainNoms[idx].title] || 0;
            
            // ЛОГИКА БЛОКИРОВКИ
            let isLocked = votedFor !== undefined;
            if(isLocked) {
                document.getElementById('lockedMessage').style.display = 'block';
                document.getElementById('votedName').innerText = votedFor;
                document.getElementById('changesLeft').innerText = (3 - changesDone);
                g.classList.add('locked');
                
                // Если лимит исчерпан
                document.getElementById('changeBtn').style.display = (changesDone >= 3) ? 'none' : 'inline-block';
            } else {
                document.getElementById('lockedMessage').style.display = 'none';
                g.classList.remove('locked');
            }

            let isBigIcon = ["Лучшая постройка", "Фейл года", "Завоз года"].includes(mainNoms[idx].title);

            mainNoms[idx].cands.forEach(c => {
                let d = document.createElement('div'); d.className = 'cand-card';
                if(isBigIcon) d.classList.add('big-mode');
                if(votedFor === c) d.classList.add('selected');

                let safeNom = mainNoms[idx].title.replace(/[\s\/]/g, '_');
                let safeCand = c.replace(/[\s\/]/g, '_');
                let imgPng = `${API_URL}/static/cand_${safeNom}_${safeCand}.png`;
                let imgJpg = `${API_URL}/static/cand_${safeNom}_${safeCand}.jpg`;
                
                // DETECTOR VIDEO ICON
                let vidUrl = `${API_URL}/static/cand_${safeNom}_${safeCand}.mp4`;
                let vidBadge = `<div id="vid-${safeCand}" class="video-badge" style="display:none"><i class="fas fa-video"></i></div>`;
                
                // Check if video exists
                let vtest = document.createElement('video');
                vtest.src = vidUrl;
                vtest.onloadedmetadata = () => { document.getElementById(`vid-${safeCand}`).style.display = 'flex'; };

                let phIcon = mainNoms[idx].isPerson ? '<i class="fas fa-user"></i>' : c.charAt(0);
                
                d.innerHTML = `
                    ${vidBadge}
                    <div class="cand-avatar">
                        <img src="${imgPng}" style="width:100%;height:100%;object-fit:cover;border-radius:10px;display:none;" 
                             onload="this.style.display='block'; this.nextElementSibling.style.display='none'"
                             onerror="this.onerror=null; this.src='${imgJpg}'">
                        <span>${phIcon}</span>
                    </div>
                    <div class="cand-name">${c}</div>`;
                
                d.onclick=()=>{ 
                    if(g.classList.contains('locked')) return; 
                    openPreview(c); 
                };
                g.appendChild(d);
            });
            
            if(votedFor && !mainNoms[idx].cands.includes(votedFor)) {
               document.getElementById('customCandName').value = votedFor;
            } else {
               document.getElementById('customCandName').value = ''; 
            }
            openModal('voteModal');
        }

        function unlockVote() {
            document.getElementById('candGrid').classList.remove('locked');
            document.getElementById('lockedMessage').style.display = 'none';
        }

        function openPreview(candName) {
            currentCand = candName;
            closeModal('voteModal');
            openModal('previewModal');
            
            document.getElementById('previewTitle').innerText = candName;
            const container = document.getElementById('previewMediaContainer');
            container.innerHTML = '<div style="color:#666">Поиск медиа...</div>';
            
            let safeNom = mainNoms[currIdx].title.replace(/[\s\/]/g, '_');
            let safeCand = candName.replace(/[\s\/]/g, '_');
            
            let vidUrl = `${API_URL}/static/cand_${safeNom}_${safeCand}.mp4`;
            let imgPng = `${API_URL}/static/cand_${safeNom}_${safeCand}.png`;
            let imgJpg = `${API_URL}/static/cand_${safeNom}_${safeCand}.jpg`;
            
            let video = document.createElement('video');
            video.src = vidUrl; video.controls = true; video.autoplay = true; video.muted = false; video.loop = true;
            
            video.onloadedmetadata = () => { container.innerHTML = '<div style="color:#0f0">Видео найдено, подождите...</div>'; };
            video.oncanplay = () => { container.innerHTML = ''; container.appendChild(video); };
            
            video.onerror = () => {
                let img = new Image(); img.src = imgPng;
                img.onload = () => { container.innerHTML = ''; container.appendChild(img); };
                img.onerror = () => {
                    let img2 = new Image(); img2.src = imgJpg;
                    img2.onload = () => { container.innerHTML = ''; container.appendChild(img2); };
                    img2.onerror = () => {
                        container.innerHTML = '<div style="font-size:8em;color:var(--red);padding:40px;"><i class="fas fa-user"></i></div>';
                    }
                }
            };
        }

        async function confirmVote() {
            closeModal('previewModal');
            sendVote(currentCand);
        }

        let myToken = localStorage.getItem('tk');
        let tmr;

        async function openProfile() {
            openModal('profileModal');
            if(!myToken) await refreshToken(); else check(false);
        }

        async function refreshToken() {
            try {
                let res = await fetch(API_URL + '/api/get_token');
                let d = await res.json();
                myToken = d.token; localStorage.setItem('tk', myToken);
                check(false);
            } catch(e) { toast("Нет связи"); }
        }
        
        function hardReset() {
            localStorage.removeItem('tk');
            myToken = null;
            refreshToken();
        }

        async function check(manual) {
            const btn = document.getElementById('checkBtn');
            if(manual) { btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>'; btn.style.background = "#555"; }

            try {
                let res = await fetch(API_URL + '/api/check_status', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({token:myToken})});
                let d = await res.json();
                
                if (d.expired) { 
                    document.getElementById('statusText').innerText = "КОД ИСТЕК";
                    document.getElementById('statusText').style.color = "red";
                    document.getElementById('loading').style.display='none';
                    document.getElementById('profileContent').style.display='block';
                    if(manual) { btn.innerText = "ИСТЕК"; btn.style.background = "red"; setTimeout(()=>{btn.innerText="ОБНОВИТЬ"; btn.style.background="var(--red)"}, 2000); }
                    return; 
                }

                document.getElementById('loading').style.display='none';
                document.getElementById('profileContent').style.display='block';
                const tokenInput = document.getElementById('tokenDisplay');
                tokenInput.value = myToken; tokenInput.removeAttribute('readonly'); 

                document.getElementById('statVoted').innerText = d.vote_count || 0;
                document.getElementById('statLeft').innerText = totalNoms - (d.vote_count || 0);
                
                myVotes = d.my_votes || {}; 
                myChanges = d.changes || {}; // Получаем счетчик изменений
                updateMain(); 

                const st = document.getElementById('statusText');
                const auth = document.getElementById('authSection');
                
                if(d.status==='approved') {
                    st.innerText = "ЗАРЕГИСТРИРОВАН"; st.style.color = "#0f0";
                    document.getElementById('timer').style.display='none';
                    if(manual) { btn.innerText = "УСПЕХ"; btn.style.background = "#0f0"; setTimeout(()=>{btn.innerText="ОБНОВИТЬ"; btn.style.background="var(--red)"}, 2000); }
                } else {
                    st.innerText = d.status==='review'?"НА ПРОВЕРКЕ":"НЕ ЗАРЕГИСТРИРОВАН";
                    st.style.color = d.status==='review'?"#fa0":"#555";
                    auth.style.display = 'block'; startTimer(d.time_left);
                    if(manual) { btn.innerText = "ЖДЕМ..."; btn.style.background = "#fa0"; setTimeout(()=>{btn.innerText="ОБНОВИТЬ"; btn.style.background="var(--red)"}, 2000); }
                }
                updateSlots(d.suggestions.length, d.suggestions || []);
            } catch(e) { toast("Ошибка сервера"); if(manual) btn.innerText = "ОШИБКА"; }
        }

        function startTimer(s) {
            clearInterval(tmr); let l=Math.floor(s);
            const display = document.getElementById('timer');
            display.style.display = 'block';
            if(l <= 0) { display.innerText = "00:00 (Обновите код)"; return; }
            tmr = setInterval(() => {
                if(l<=0) { clearInterval(tmr); display.innerText = "00:00"; return; }
                l--; display.innerText = `${Math.floor(l/60)}:${(l%60)<10?'0'+(l%60):l%60}`;
            }, 1000);
        }

        async function submitVote() {
            const sel = document.querySelector('.cand-card.selected');
            if(!sel) { toast("Выбери кандидата!"); return; }
            sendVote(sel.dataset.val);
        }

        async function submitCustomVote() {
            const val = document.getElementById('customCandName').value;
            if(!val) { toast("Введите имя!"); return; }
            sendVote(val);
        }

        async function sendVote(cand) {
            try {
                let res = await fetch(API_URL + '/api/vote', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({token:myToken, nomination:mainNoms[currIdx].title, candidate:cand})});
                let d = await res.json();
                if(d.success) { toast("ПРИНЯТО!"); closeModal('voteModal'); check(false); }
                else toast(d.message);
            } catch(e) { toast("Ошибка!"); }
        }

        async function sendSuggestion() {
            let nom = document.getElementById('sugName').value;
            let desc = document.getElementById('sugDesc').value;
            if(!nom || !desc) { toast("Заполни все поля!"); return; }
            try {
                let res = await fetch(API_URL + '/api/suggest', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({token:myToken, nomination:nom, description:desc})});
                let d = await res.json();
                toast(d.message);
                if(d.success) { 
                    document.getElementById('sugName').value=''; document.getElementById('sugDesc').value='';
                    updateSlots(d.suggestions.length, d.suggestions); check(false);
                }
            } catch(e) { toast("Ошибка!"); }
        }

        function updateSlots(cnt, list) {
            const cont = document.getElementById('slotsCont'); cont.innerHTML='';
            const hist = document.getElementById('sugList'); hist.innerHTML='';
            const histBox = document.getElementById('sugHistory');
            document.getElementById('sugCounterText').innerText = `${cnt}/5`;
            if(cnt >= 5) { document.getElementById('sugForm').style.display = 'none'; document.getElementById('sugLimitMsg').style.display = 'block'; }
            for(let i=0; i<5; i++) { let div = document.createElement('div'); div.className = i < cnt ? 'slot filled' : 'slot empty'; cont.appendChild(div); }
            if(list && list.length > 0) {
                histBox.style.display = 'block';
                list.forEach(item => { let div = document.createElement('div'); div.className = 'sug-item'; div.innerText = item; hist.appendChild(div); });
            } else { histBox.style.display = 'none'; }
        }

        function toast(msg) { let t = document.getElementById('toast'); t.innerText=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),3000); }
        
        const pc = document.getElementById('particles');
        for(let i=0;i<40;i++) {
            let p=document.createElement('div'); p.className='particle';
            p.style.left=Math.random()*100+'%'; p.style.width=p.style.height=(Math.random()*5+2)+'px';
            p.style.animationDuration=(Math.random()*5+5)+'s'; p.style.animationDelay=Math.random()*5+'s';
            pc.appendChild(p);
        }
        
        window.addEventListener('scroll', ()=>{
            const headerBtns = document.querySelector('.header-btns-container');
            const h = document.getElementById('mainHeader').getBoundingClientRect();
            const showFab = h.bottom < 0;
            document.querySelector('.fab-rules').classList.toggle('visible', showFab);
            document.querySelector('.fab-profile').classList.toggle('visible', showFab);
            if(headerBtns && window.innerWidth > 768) { headerBtns.style.opacity = showFab ? '0' : '1'; headerBtns.style.pointerEvents = showFab ? 'none' : 'auto'; }
        });
    </script>
</body>
</html>
